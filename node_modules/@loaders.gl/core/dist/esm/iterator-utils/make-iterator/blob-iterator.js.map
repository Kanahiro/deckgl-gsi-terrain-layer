{"version":3,"sources":["../../../../src/iterator-utils/make-iterator/blob-iterator.js"],"names":["DEFAULT_CHUNK_SIZE","makeBlobIterator","file","options","chunkSize","offset","size","end","readFileSlice","chunk","Promise","resolve","reject","slice","fileReader","FileReader","onload","event","target","result","onerror","error","readAsArrayBuffer"],"mappings":";;;;AAEA,IAAMA,kBAAkB,GAAG,OAAO,IAAlC;AAEA,gBAAuBC,gBAAvB;AAAA;AAAA;;;mEAAO,iBAAiCC,IAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAuCC,YAAAA,OAAvC,2DAAiD,EAAjD;AACCC,YAAAA,SADD,GACaD,OAAO,CAACC,SAAR,IAAqBJ,kBADlC;AAGDK,YAAAA,MAHC,GAGQ,CAHR;;AAAA;AAAA,kBAIEA,MAAM,GAAGH,IAAI,CAACI,IAJhB;AAAA;AAAA;AAAA;;AAKGC,YAAAA,GALH,GAKSF,MAAM,GAAGD,SALlB;AAAA;AAAA,wCAOiBI,aAAa,CAACN,IAAD,EAAOG,MAAP,EAAeE,GAAf,CAP9B;;AAAA;AAOGE,YAAAA,KAPH;AASHJ,YAAAA,MAAM,GAAGE,GAAT;AATG;AAUH,mBAAME,KAAN;;AAVG;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAcP,gBAAsBD,aAAtB;AAAA;AAAA;;;8DAAO,kBAA6BN,IAA7B,EAAmCG,MAAnC,EAA2CE,GAA3C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACQ,IAAIG,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAI5C,kBAAMC,KAAK,GAAGX,IAAI,CAACW,KAAL,CAAWR,MAAX,EAAmBE,GAAnB,CAAd;AAEA,kBAAMO,UAAU,GAAG,IAAIC,UAAJ,EAAnB;;AACAD,cAAAA,UAAU,CAACE,MAAX,GAAoB,UAAAC,KAAK;AAAA,uBAAIN,OAAO,CAACM,KAAK,CAACC,MAAN,IAAgBD,KAAK,CAACC,MAAN,CAAaC,MAA9B,CAAX;AAAA,eAAzB;;AACAL,cAAAA,UAAU,CAACM,OAAX,GAAqB,UAAAC,KAAK;AAAA,uBAAIT,MAAM,CAACS,KAAD,CAAV;AAAA,eAA1B;;AACAP,cAAAA,UAAU,CAACQ,iBAAX,CAA6BT,KAA7B;AACD,aAVY,CADR;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","sourcesContent":["/* global FileReader */\n\nconst DEFAULT_CHUNK_SIZE = 1024 * 1024; // 1MB â€” biggest value that keeps UI responsive\n\nexport async function* makeBlobIterator(file, options = {}) {\n  const chunkSize = options.chunkSize || DEFAULT_CHUNK_SIZE;\n\n  let offset = 0;\n  while (offset < file.size) {\n    const end = offset + chunkSize;\n\n    const chunk = await readFileSlice(file, offset, end);\n\n    offset = end;\n    yield chunk;\n  }\n}\n\nexport async function readFileSlice(file, offset, end) {\n  return await new Promise((resolve, reject) => {\n    // The trick when reading File objects is to read successive \"slices\" of the File\n    // Per spec https://w3c.github.io/FileAPI/, slicing a File should only update the start and end fields\n    // Actually reading from file should happen in `readAsArrayBuffer` (and as far we can tell it does)\n    const slice = file.slice(offset, end);\n\n    const fileReader = new FileReader();\n    fileReader.onload = event => resolve(event.target && event.target.result);\n    fileReader.onerror = error => reject(error);\n    fileReader.readAsArrayBuffer(slice);\n  });\n}\n"],"file":"blob-iterator.js"}