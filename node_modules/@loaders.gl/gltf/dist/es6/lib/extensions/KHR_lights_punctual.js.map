{"version":3,"sources":["../../../../src/lib/extensions/KHR_lights_punctual.js"],"names":["assert","GLTFScenegraph","KHR_LIGHTS_PUNCTUAL","decode","gltfData","options","gltfScenegraph","json","extension","getExtension","lights","removeExtension","node","nodes","nodeExtension","getObjectExtension","light","removeObjectExtension","encode","addExtension","addObjectExtension"],"mappings":"AAGA,OAAOA,MAAP,MAAmB,iBAAnB;AACA,OAAOC,cAAP,MAA2B,oBAA3B;AACA,SAAQC,mBAAR,QAAkC,mBAAlC;AAEA,OAAO,SAASC,MAAT,CAAgBC,QAAhB,EAA0BC,OAA1B,EAAmC;AACxC,QAAMC,cAAc,GAAG,IAAIL,cAAJ,CAAmBG,QAAnB,CAAvB;AACA,QAAM;AAACG,IAAAA;AAAD,MAASD,cAAf;AAGA,QAAME,SAAS,GAAGF,cAAc,CAACG,YAAf,CAA4BP,mBAA5B,CAAlB;;AACA,MAAIM,SAAJ,EAAe;AAEbF,IAAAA,cAAc,CAACC,IAAf,CAAoBG,MAApB,GAA6BF,SAAS,CAACE,MAAvC;AACAJ,IAAAA,cAAc,CAACK,eAAf,CAA+BT,mBAA/B;AACD;;AAID,OAAK,MAAMU,IAAX,IAAmBL,IAAI,CAACM,KAAL,IAAc,EAAjC,EAAqC;AACnC,UAAMC,aAAa,GAAGR,cAAc,CAACS,kBAAf,CAAkCH,IAAlC,EAAwCV,mBAAxC,CAAtB;;AACA,QAAIY,aAAJ,EAAmB;AAEjBF,MAAAA,IAAI,CAACI,KAAL,GAAaF,aAAa,CAACE,KAA3B;AACD;;AACDV,IAAAA,cAAc,CAACW,qBAAf,CAAqCL,IAArC,EAA2CV,mBAA3C;AACD;AACF;AAGD,OAAO,SAASgB,MAAT,CAAgBd,QAAhB,EAA0BC,OAA1B,EAAmC;AACxC,QAAMC,cAAc,GAAG,IAAIL,cAAJ,CAAmBG,QAAnB,CAAvB;AACA,QAAM;AAACG,IAAAA;AAAD,MAASD,cAAf;;AAEA,MAAIC,IAAI,CAACG,MAAT,EAAiB;AACf,UAAMF,SAAS,GAAGF,cAAc,CAACa,YAAf,CAA4BjB,mBAA5B,CAAlB;AAEAF,IAAAA,MAAM,CAAC,CAACQ,SAAS,CAACE,MAAZ,CAAN;AAEAF,IAAAA,SAAS,CAACE,MAAV,GAAmBH,IAAI,CAACG,MAAxB;AACA,WAAOH,IAAI,CAACG,MAAZ;AACD;;AAID,MAAIJ,cAAc,CAACC,IAAf,CAAoBG,MAAxB,EAAgC;AAC9B,SAAK,MAAMM,KAAX,IAAoBV,cAAc,CAACC,IAAf,CAAoBG,MAAxC,EAAgD;AAC9C,YAAME,IAAI,GAAGI,KAAK,CAACJ,IAAnB;AACAN,MAAAA,cAAc,CAACc,kBAAf,CAAkCR,IAAlC,EAAwCV,mBAAxC,EAA6Dc,KAA7D;AACD;;AACD,WAAOV,cAAc,CAACC,IAAf,CAAoBG,MAA3B;AACD;AACF","sourcesContent":["// GLTF EXTENSION: KHR_lights_punctual\n// https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\n\nimport assert from '../utils/assert';\nimport GLTFScenegraph from '../gltf-scenegraph';\nimport {KHR_LIGHTS_PUNCTUAL} from '../gltf-constants';\n\nexport function decode(gltfData, options) {\n  const gltfScenegraph = new GLTFScenegraph(gltfData);\n  const {json} = gltfScenegraph;\n\n  // Move the light array out of the extension and remove the extension\n  const extension = gltfScenegraph.getExtension(KHR_LIGHTS_PUNCTUAL);\n  if (extension) {\n    // @ts-ignore\n    gltfScenegraph.json.lights = extension.lights;\n    gltfScenegraph.removeExtension(KHR_LIGHTS_PUNCTUAL);\n  }\n\n  // Any nodes that have the extension, add lights field pointing to light object\n  // and remove the extension\n  for (const node of json.nodes || []) {\n    const nodeExtension = gltfScenegraph.getObjectExtension(node, KHR_LIGHTS_PUNCTUAL);\n    if (nodeExtension) {\n      // @ts-ignore\n      node.light = nodeExtension.light;\n    }\n    gltfScenegraph.removeObjectExtension(node, KHR_LIGHTS_PUNCTUAL);\n  }\n}\n\n// Move the light ar ray out of the extension and remove the extension\nexport function encode(gltfData, options) {\n  const gltfScenegraph = new GLTFScenegraph(gltfData);\n  const {json} = gltfScenegraph;\n\n  if (json.lights) {\n    const extension = gltfScenegraph.addExtension(KHR_LIGHTS_PUNCTUAL);\n    // @ts-ignore\n    assert(!extension.lights);\n    // @ts-ignore\n    extension.lights = json.lights;\n    delete json.lights;\n  }\n\n  // Any nodes that have lights field pointing to light object\n  // add the extension\n  if (gltfScenegraph.json.lights) {\n    for (const light of gltfScenegraph.json.lights) {\n      const node = light.node;\n      gltfScenegraph.addObjectExtension(node, KHR_LIGHTS_PUNCTUAL, light);\n    }\n    delete gltfScenegraph.json.lights;\n  }\n}\n"],"file":"KHR_lights_punctual.js"}