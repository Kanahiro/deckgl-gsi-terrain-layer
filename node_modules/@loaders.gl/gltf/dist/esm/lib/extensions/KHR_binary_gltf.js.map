{"version":3,"sources":["../../../../src/lib/extensions/KHR_binary_gltf.js"],"names":["GLTFScenegraph","KHR_BINARY_GLTF","decode","gltfData","options","gltfScenegraph","json","images","node","extension","removeObjectExtension","Object","assign","buffers","uri","removeExtension","encode","Error"],"mappings":";;;;;;AAGA,OAAOA,cAAP,MAA2B,oBAA3B;AACA,SAAQC,eAAR,QAA8B,mBAA9B;AAEA,OAAO,SAASC,MAAT,CAAgBC,QAAhB,EAA0BC,OAA1B,EAAmC;AACxC,MAAMC,cAAc,GAAG,IAAIL,cAAJ,CAAmBG,QAAnB,CAAvB;AADwC,MAEjCG,IAFiC,GAEzBD,cAFyB,CAEjCC,IAFiC;;AAAA,6CASrBA,IAAI,CAACC,MAAL,IAAe,EATM;AAAA;;AAAA;AASxC,wDAAsC;AAAA,UAA3BC,IAA2B;AACpC,UAAMC,SAAS,GAAGJ,cAAc,CAACK,qBAAf,CAAqCF,IAArC,EAA2CP,eAA3C,CAAlB;;AAEA,UAAIQ,SAAJ,EAAe;AACbE,QAAAA,MAAM,CAACC,MAAP,CAAcJ,IAAd,EAAoBC,SAApB;AACD;AACF;AAfuC;AAAA;AAAA;AAAA;AAAA;;AAqBxC,MAAIH,IAAI,CAACO,OAAL,IAAgBP,IAAI,CAACO,OAAL,CAAa,CAAb,CAApB,EAAqC;AACnC,WAAOP,IAAI,CAACO,OAAL,CAAa,CAAb,EAAgBC,GAAvB;AACD;;AAGDT,EAAAA,cAAc,CAACU,eAAf,CAA+Bd,eAA/B;AACD;AAGD,OAAO,SAASe,MAAT,CAAgBb,QAAhB,EAA0BC,OAA1B,EAAmC;AACxC,QAAM,IAAIa,KAAJ,CAAUhB,eAAV,CAAN;AACD","sourcesContent":["// GLTF 1.0 EXTENSION: KHR_binary_glTF\n// https://github.com/KhronosGroup/glTF/tree/master/extensions/1.0/Khronos/KHR_binary_glTF\n\nimport GLTFScenegraph from '../gltf-scenegraph';\nimport {KHR_BINARY_GLTF} from '../gltf-constants';\n\nexport function decode(gltfData, options) {\n  const gltfScenegraph = new GLTFScenegraph(gltfData);\n  const {json} = gltfScenegraph;\n\n  // Note: json.buffers.binary_glTF also needs to be replaced\n  // This is currently done during gltf normalization\n\n  // Image and shader nodes can have the extension\n  // https://github.com/KhronosGroup/glTF/blob/master/extensions/1.0/Khronos/KHR_binary_glTF/schema/image.KHR_binary_glTF.schema.json\n  for (const node of json.images || []) {\n    const extension = gltfScenegraph.removeObjectExtension(node, KHR_BINARY_GLTF);\n    // The data in the extension is valid as glTF 2.0 data inside the object, so just copy it in\n    if (extension) {\n      Object.assign(node, extension);\n    }\n  }\n\n  // TODO shaders\n  // https://github.com/KhronosGroup/glTF/blob/master/extensions/1.0/Khronos/KHR_binary_glTF/schema/shader.KHR_binary_glTF.schema.json\n\n  // glTF v1 one files have a partially formed URI field that is not expected in (and causes problems in) 2.0\n  if (json.buffers && json.buffers[0]) {\n    delete json.buffers[0].uri;\n  }\n\n  // Remove the top-level extension as it has now been removed from all nodes\n  gltfScenegraph.removeExtension(KHR_BINARY_GLTF);\n}\n\n// KHR_binary_gltf is a 1.0 extension that is supported natively by 2.0\nexport function encode(gltfData, options) {\n  throw new Error(KHR_BINARY_GLTF);\n}\n"],"file":"KHR_binary_gltf.js"}