{"version":3,"sources":["../../../../src/lib/binary-utils/binary-copy-utils.js"],"names":["copyPaddedArrayBufferToDataView","dataView","byteOffset","sourceBuffer","paddedLength","byteLength","padLength","targetArray","Uint8Array","buffer","sourceArray","set","i","setUint8","copyPaddedStringToDataView","string","textEncoder","TextEncoder","stringBuffer","encode"],"mappings":";;;;;;;;AACA;;AAEO,SAASA,+BAAT,CAAyCC,QAAzC,EAAmDC,UAAnD,EAA+DC,YAA/D,EAA6E;AAClF,MAAMC,YAAY,GAAG,kCAAYD,YAAY,CAACE,UAAzB,CAArB;AACA,MAAMC,SAAS,GAAGF,YAAY,GAAGD,YAAY,CAACE,UAA9C;;AAEA,MAAIJ,QAAJ,EAAc;AAEZ,QAAMM,WAAW,GAAG,IAAIC,UAAJ,CAClBP,QAAQ,CAACQ,MADS,EAElBR,QAAQ,CAACC,UAAT,GAAsBA,UAFJ,EAGlBC,YAAY,CAACE,UAHK,CAApB;AAKA,QAAMK,WAAW,GAAG,IAAIF,UAAJ,CAAeL,YAAf,CAApB;AACAI,IAAAA,WAAW,CAACI,GAAZ,CAAgBD,WAAhB;;AAGA,SAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,SAApB,EAA+B,EAAEM,CAAjC,EAAoC;AAElCX,MAAAA,QAAQ,CAACY,QAAT,CAAkBX,UAAU,GAAGC,YAAY,CAACE,UAA1B,GAAuCO,CAAzD,EAA4D,IAA5D;AACD;AACF;;AACDV,EAAAA,UAAU,IAAIE,YAAd;AACA,SAAOF,UAAP;AACD;;AAEM,SAASY,0BAAT,CAAoCb,QAApC,EAA8CC,UAA9C,EAA0Da,MAA1D,EAAkE;AACvE,MAAMC,WAAW,GAAG,IAAIC,WAAJ,EAApB;AAGA,MAAMC,YAAY,GAAGF,WAAW,CAACG,MAAZ,CAAmBJ,MAAnB,CAArB;AAEAb,EAAAA,UAAU,GAAGF,+BAA+B,CAACC,QAAD,EAAWC,UAAX,EAAuBgB,YAAvB,CAA5C;AAEA,SAAOhB,UAAP;AACD","sourcesContent":["/* global TextEncoder */\nimport {padTo4Bytes} from './memory-copy-utils';\n\nexport function copyPaddedArrayBufferToDataView(dataView, byteOffset, sourceBuffer) {\n  const paddedLength = padTo4Bytes(sourceBuffer.byteLength);\n  const padLength = paddedLength - sourceBuffer.byteLength;\n\n  if (dataView) {\n    // Copy array\n    const targetArray = new Uint8Array(\n      dataView.buffer,\n      dataView.byteOffset + byteOffset,\n      sourceBuffer.byteLength\n    );\n    const sourceArray = new Uint8Array(sourceBuffer);\n    targetArray.set(sourceArray);\n\n    // Add PADDING\n    for (let i = 0; i < padLength; ++i) {\n      // json chunk is padded with spaces (ASCII 0x20)\n      dataView.setUint8(byteOffset + sourceBuffer.byteLength + i, 0x20);\n    }\n  }\n  byteOffset += paddedLength;\n  return byteOffset;\n}\n\nexport function copyPaddedStringToDataView(dataView, byteOffset, string) {\n  const textEncoder = new TextEncoder();\n  // PERFORMANCE IDEA: We encode twice, once to get size and once to store\n  // PERFORMANCE IDEA: Use TextEncoder.encodeInto() to avoid temporary copy\n  const stringBuffer = textEncoder.encode(string);\n\n  byteOffset = copyPaddedArrayBufferToDataView(dataView, byteOffset, stringBuffer);\n\n  return byteOffset;\n}\n"],"file":"binary-copy-utils.js"}