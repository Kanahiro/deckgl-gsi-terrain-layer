!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=19)}([,function(t,e,n){"use strict";(function(t,r){n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return u}));const i={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document},s=i.global||i.self||i.window,o="object"!=typeof r||"[object process]"!==String(r)||r.browser,a=void 0!==r&&r.version&&r.version.match(/v([0-9]*)/),u=a&&parseFloat(a[1])||0}).call(this,n(12),n(13))},,function(t,e,n){"use strict";(function(t){function r(){var e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if(void 0!==t&&t.hrtime){var n=t.hrtime();e=1e3*n[0]+n[1]/1e6}else e=Date.now();return e}n.d(e,"a",(function(){return r}))}).call(this,n(13))},,,,function(t,e){},,,,,function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){var n,r,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(t){n=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(t){r=o}}();var u,c=[],h=!1,l=-1;function f(){h&&u&&(h=!1,u.length?c=u.concat(c):l=-1,c.length&&d())}function d(){if(!h){var t=a(f);h=!0;for(var e=c.length;e;){for(u=c,c=[];++l<e;)u&&u[l].run();l=-1,e=c.length}u=null,h=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function y(t,e){this.fun=t,this.array=e}function p(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new y(t,e)),1!==c.length||h||a(d)},y.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},,,,,,function(t,e,n){(function(e){const r=n(20),i="undefined"==typeof window?e:window;i.loaders=i.loaders||{},t.exports=Object.assign(i.loaders,r)}).call(this,n(12))},function(t,e,n){"use strict";n.r(e),n.d(e,"Tileset3D",(function(){return _i})),n.d(e,"Tile3D",(function(){return hi})),n.d(e,"TilesetTraverser",(function(){return di})),n.d(e,"TilesetCache",(function(){return re})),n.d(e,"createBoundingVolume",(function(){return ni})),n.d(e,"calculateTransformProps",(function(){return ie})),n.d(e,"getFrameState",(function(){return Pn})),n.d(e,"TILE_CONTENT_STATE",(function(){return Gr})),n.d(e,"TILE_REFINEMENT",(function(){return Qr})),n.d(e,"TILE_TYPE",(function(){return Kr})),n.d(e,"TILESET_TYPE",(function(){return Yr})),n.d(e,"LOD_METRIC_TYPE",(function(){return Zr}));var r={};function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,s=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw s}}return n}}(t,e)||s(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function m(t,e,n){return(m=p()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&h(i,n.prototype),i}).apply(null,arguments)}function v(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}n.r(r),n.d(r,"dirname",(function(){return Xt}));var w=1/Math.PI*180,b=1/180*Math.PI,_={};function k(t){return Math.round(t/_.EPSILON)*_.EPSILON}function T(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.precision,r=void 0===n?_.precision||4:n;return t=k(t),"".concat(parseFloat(t.toPrecision(r)))}function S(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function M(t,e,n){if(S(t)){n=n||((i=t).clone?i.clone():new Array(i.length));for(var r=0;r<n.length&&r<t.length;++r)n[r]=e(t[r],r,n);return n}var i;return e(t)}function E(t){return function(t,e){return M(t,(function(t){return t*b}),e)}(t)}function x(t){return R(t)}function R(t,e){return M(t,(function(t){return t*w}),e)}function O(t,e,n){var r=_.EPSILON;n&&(_.EPSILON=n);try{if(t===e)return!0;if(S(t)&&S(e)){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(!O(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=_.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{_.EPSILON=r}}function A(t,e){if(t.length!==e)return!1;for(var n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function C(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function N(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(_.debug&&!A(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}_.EPSILON=1e-12,_.debug=!1,_.precision=4,_.printTypes=!1,_.printDegrees=!1,_.printRowMajor=!0;var P={};function D(t,e){P[t]||(P[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}function I(t){var e="function"==typeof Map?new Map:void 0;return(I=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return m(t,arguments,y(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),h(r,t)})(t)}function q(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=y(t);if(e){var i=y(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d(this,n)}}var L=function(t){l(n,t);var e=q(n);function n(){return a(this,n),e.apply(this,arguments)}return c(n,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}},{key:"to",value:function(t){return t===this?this:S(t)?this.toArray(t):this.toObject(t)}},{key:"toTarget",value:function(t){return t?this.to(t):this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(_)}},{key:"formatString",value:function(t){for(var e="",n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+T(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!O(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"lerp",value:function(t,e,n){void 0===n&&(n=e,e=t,t=this);for(var r=0;r<this.ELEMENTS;++r){var i=t[r];this[r]=i+n*(e[r]-i)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var s=i[r],o=0;o<this.ELEMENTS;++o)this[o]+=s[o];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var s=i[r],o=0;o<this.ELEMENTS;++o)this[o]-=s[o];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}},{key:"multiplyByScalar",value:function(t){return this.scale(t)}},{key:"check",value:function(){if(_.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}},{key:"ELEMENTS",get:function(){return g(!1),0}},{key:"RANK",get:function(){return g(!1),0}},{key:"elements",get:function(){return this}}]),n}(I(Array));function V(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=y(t);if(e){var i=y(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d(this,n)}}var j=function(t){l(n,t);var e=V(n);function n(){return a(this,n),e.apply(this,arguments)}return c(n,[{key:"toString",value:function(){var t="[";if(_.printRowMajor){t+="row-major:";for(var e=0;e<this.RANK;++e)for(var n=0;n<this.RANK;++n)t+=" ".concat(this[n*this.RANK+e])}else{t+="column-major:";for(var r=0;r<this.ELEMENTS;++r)t+=" ".concat(this[r])}return t+="]"}},{key:"getElementIndex",value:function(t,e){return e*this.RANK+t}},{key:"getElement",value:function(t,e){return this[e*this.RANK+t]}},{key:"setElement",value:function(t,e,n){return this[e*this.RANK+t]=C(n),this}},{key:"getColumn",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),n=t*this.RANK,r=0;r<this.RANK;++r)e[r]=this[n+r];return e}},{key:"setColumn",value:function(t,e){for(var n=t*this.RANK,r=0;r<this.RANK;++r)this[n+r]=e[r];return this}}]),n}(L);function z(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}var U=1e-6,F="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function B(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],d=e[10],y=e[11],p=e[12],m=e[13],v=e[14],g=e[15],w=n[0],b=n[1],_=n[2],k=n[3];return t[0]=w*r+b*a+_*l+k*p,t[1]=w*i+b*u+_*f+k*m,t[2]=w*s+b*c+_*d+k*v,t[3]=w*o+b*h+_*y+k*g,w=n[4],b=n[5],_=n[6],k=n[7],t[4]=w*r+b*a+_*l+k*p,t[5]=w*i+b*u+_*f+k*m,t[6]=w*s+b*c+_*d+k*v,t[7]=w*o+b*h+_*y+k*g,w=n[8],b=n[9],_=n[10],k=n[11],t[8]=w*r+b*a+_*l+k*p,t[9]=w*i+b*u+_*f+k*m,t[10]=w*s+b*c+_*d+k*v,t[11]=w*o+b*h+_*y+k*g,w=n[12],b=n[13],_=n[14],k=n[15],t[12]=w*r+b*a+_*l+k*p,t[13]=w*i+b*u+_*f+k*m,t[14]=w*s+b*c+_*d+k*v,t[15]=w*o+b*h+_*y+k*g,t}function W(t,e,n){var r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function $(t,e){var n=e[0],r=e[1],i=e[2],s=e[4],o=e[5],a=e[6],u=e[8],c=e[9],h=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(u,c,h),t}function G(t,e,n,r,i){var s,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(s=1/(r-i),t[10]=(i+r)*s,t[14]=2*i*r*s):(t[10]=-1,t[14]=-2*r),t}function Q(t,e,n,r){var i,s,o,a,u,c,h,l,f,d,y=e[0],p=e[1],m=e[2],v=r[0],g=r[1],w=r[2],b=n[0],_=n[1],k=n[2];return Math.abs(y-b)<U&&Math.abs(p-_)<U&&Math.abs(m-k)<U?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(h=y-b,l=p-_,f=m-k,i=g*(f*=d=1/Math.hypot(h,l,f))-w*(l*=d),s=w*(h*=d)-v*f,o=v*l-g*h,(d=Math.hypot(i,s,o))?(i*=d=1/d,s*=d,o*=d):(i=0,s=0,o=0),a=l*o-f*s,u=f*i-h*o,c=h*s-l*i,(d=Math.hypot(a,u,c))?(a*=d=1/d,u*=d,c*=d):(a=0,u=0,c=0),t[0]=i,t[1]=a,t[2]=h,t[3]=0,t[4]=s,t[5]=u,t[6]=l,t[7]=0,t[8]=o,t[9]=c,t[10]=f,t[11]=0,t[12]=-(i*y+s*p+o*m),t[13]=-(a*y+u*p+c*m),t[14]=-(h*y+l*p+f*m),t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var K,Y;K=new F(2),F!=Float32Array&&(K[0]=0,K[1]=0),Y=K;function Z(){var t=new F(3);return F!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function X(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function H(t,e,n){var r=new F(3);return r[0]=t,r[1]=e,r[2]=n,r}function J(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function tt(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],u=n[2];return t[0]=i*u-s*a,t[1]=s*o-r*u,t[2]=r*a-i*o,t}function et(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function nt(t,e,n){var r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}var rt=X;!function(){var t=Z()}();function it(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function st(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function ot(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],u=n[2],c=n[3],h=c*r+a*s-u*i,l=c*i+u*r-o*s,f=c*s+o*i-a*r,d=-o*r-a*i-u*s;return t[0]=h*c+d*-o+l*-u-f*-a,t[1]=l*c+d*-a+f*-o-h*-u,t[2]=f*c+d*-u+h*-a-l*-o,t[3]=e[3],t}!function(){var t=function(){var t=new F(4);return F!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}()}();function at(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=y(t);if(e){var i=y(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d(this,n)}}var ut=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),ct=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),ht=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),lt={},ft=function(t){l(n,t);var e=at(n);function n(t){var r;return a(this,n),r=e.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?r.copy(t):r.identity(),r}return c(n,[{key:"INDICES",get:function(){return ht}},{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}}],[{key:"IDENTITY",get:function(){return lt.IDENTITY=lt.IDENTITY||Object.freeze(new n(ut)),lt.IDENTITY}},{key:"ZERO",get:function(){return lt.ZERO=lt.ZERO||Object.freeze(new n(ct)),lt.ZERO}}]),c(n,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}},{key:"set",value:function(t,e,n,r,i,s,o,a,u,c,h,l,f,d,y,p){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this[4]=i,this[5]=s,this[6]=o,this[7]=a,this[8]=u,this[9]=c,this[10]=h,this[11]=l,this[12]=f,this[13]=d,this[14]=y,this[15]=p,this.check()}},{key:"setRowMajor",value:function(t,e,n,r,i,s,o,a,u,c,h,l,f,d,y,p){return this[0]=t,this[1]=i,this[2]=u,this[3]=f,this[4]=e,this[5]=s,this[6]=c,this[7]=d,this[8]=n,this[9]=o,this[10]=h,this[11]=y,this[12]=r,this[13]=a,this[14]=l,this[15]=p,this.check()}},{key:"toRowMajor",value:function(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}},{key:"identity",value:function(){return this.copy(ut)}},{key:"fromQuaternion",value:function(t){return function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,u=i+i,c=n*o,h=r*o,l=r*a,f=i*o,d=i*a,y=i*u,p=s*o,m=s*a,v=s*u;t[0]=1-l-y,t[1]=h+v,t[2]=f-m,t[3]=0,t[4]=h-v,t[5]=1-c-y,t[6]=d+p,t[7]=0,t[8]=f+m,t[9]=d-p,t[10]=1-c-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}},{key:"frustum",value:function(t){var e=t.left,r=t.right,i=t.bottom,s=t.top,o=t.near,a=t.far;return a===1/0?n._computeInfinitePerspectiveOffCenter(this,e,r,i,s,o):function(t,e,n,r,i,s,o){var a=1/(n-e),u=1/(i-r),c=1/(s-o);t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*u,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*u,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0}(this,e,r,i,s,o,a),this.check()}},{key:"lookAt",value:function(t,e,n){if(1===arguments.length){var r=t;t=r.eye,e=r.center,n=r.up}return Q(this,t,e=e||[0,0,0],n=n||[0,1,0]),this.check()}},{key:"ortho",value:function(t){var e=t.left,n=t.right,r=t.bottom,i=t.top,s=t.near,o=void 0===s?.1:s,a=t.far;return function(t,e,n,r,i,s,o){var a=1/(e-n),u=1/(r-i),c=1/(s-o);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*u,t[14]=(o+s)*c,t[15]=1}(this,e,n,r,i,o,void 0===a?500:a),this.check()}},{key:"orthographic",value:function(t){var e=t.fovy,r=void 0===e?45*Math.PI/180:e,i=t.aspect,s=void 0===i?1:i,o=t.focalDistance,a=void 0===o?1:o,u=t.near,c=void 0===u?.1:u,h=t.far,l=void 0===h?500:h;if(r>2*Math.PI)throw Error("radians");var f=r/2,d=a*Math.tan(f),y=d*s;return(new n).ortho({left:-y,right:y,bottom:-d,top:d,near:c,far:l})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,n=void 0===e?void 0:e,r=t.fov,i=void 0===r?45*Math.PI/180:r,s=t.aspect,o=void 0===s?1:s,a=t.near,u=void 0===a?.1:a,c=t.far,h=void 0===c?500:c;if((n=n||i)>2*Math.PI)throw Error("radians");return G(this,n,o,u,h),this.check()}},{key:"determinant",value:function(){return e=(t=this)[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],u=t[7],c=t[8],h=t[9],l=t[10],f=t[11],d=t[12],y=t[13],p=t[14],m=t[15],(e*o-n*s)*(l*m-f*p)-(e*a-r*s)*(h*m-f*y)+(e*u-i*s)*(h*p-l*y)+(n*a-r*o)*(c*m-f*d)-(n*u-i*o)*(c*p-l*d)+(r*u-i*a)*(c*y-h*d);var t,e,n,r,i,s,o,a,u,c,h,l,f,d,y,p,m}},{key:"getScale",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}},{key:"getTranslation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}},{key:"getRotation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(e||[-0,-0,-0]),r=1/n[0],i=1/n[1],s=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*s,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*i,t[6]=this[6]*s,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*i,t[10]=this[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{key:"getRotationMatrix3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(e||[-0,-0,-0]),r=1/n[0],i=1/n[1],s=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*s,t[3]=this[4]*r,t[4]=this[5]*i,t[5]=this[6]*s,t[6]=this[8]*r,t[7]=this[9]*i,t[8]=this[10]*s,t}},{key:"transpose",value:function(){return function(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],h=e[8],l=e[9],f=e[10],d=e[11],y=e[12],p=e[13],m=e[14],v=e[15],g=n*a-r*o,w=n*u-i*o,b=n*c-s*o,_=r*u-i*a,k=r*c-s*a,T=i*c-s*u,S=h*p-l*y,M=h*m-f*y,E=h*v-d*y,x=l*m-f*p,R=l*v-d*p,O=f*v-d*m,A=g*O-w*R+b*x+_*E-k*M+T*S;A&&(A=1/A,t[0]=(a*O-u*R+c*x)*A,t[1]=(i*R-r*O-s*x)*A,t[2]=(p*T-m*k+v*_)*A,t[3]=(f*k-l*T-d*_)*A,t[4]=(u*E-o*O-c*M)*A,t[5]=(n*O-i*E+s*M)*A,t[6]=(m*b-y*T-v*w)*A,t[7]=(h*T-f*b+d*w)*A,t[8]=(o*R-a*E+c*S)*A,t[9]=(r*E-n*R-s*S)*A,t[10]=(y*k-p*b+v*g)*A,t[11]=(l*b-h*k-d*g)*A,t[12]=(a*M-o*x-u*S)*A,t[13]=(n*x-r*M+i*S)*A,t[14]=(p*w-y*_-m*g)*A,t[15]=(h*_-l*w+f*g)*A)}(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return B(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return B(this,this,t),this.check()}},{key:"rotateX",value:function(t){return function(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],u=e[7],c=e[8],h=e[9],l=e[10],f=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+c*r,t[5]=o*i+h*r,t[6]=a*i+l*r,t[7]=u*i+f*r,t[8]=c*i-s*r,t[9]=h*i-o*r,t[10]=l*i-a*r,t[11]=f*i-u*r}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],u=e[3],c=e[8],h=e[9],l=e[10],f=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-c*r,t[1]=o*i-h*r,t[2]=a*i-l*r,t[3]=u*i-f*r,t[8]=s*r+c*i,t[9]=o*r+h*i,t[10]=a*r+l*i,t[11]=u*r+f*i}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],u=e[3],c=e[4],h=e[5],l=e[6],f=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+c*r,t[1]=o*i+h*r,t[2]=a*i+l*r,t[3]=u*i+f*r,t[4]=c*i-s*r,t[5]=h*i-o*r,t[6]=l*i-a*r,t[7]=f*i-u*r}(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=o(t,3),n=e[0],r=e[1],i=e[2];return this.rotateX(n).rotateY(r).rotateZ(i)}},{key:"rotateAxis",value:function(t,e){return function(t,e,n,r){var i,s,o,a,u,c,h,l,f,d,y,p,m,v,g,w,b,_,k,T,S,M,E,x,R=r[0],O=r[1],A=r[2],C=Math.hypot(R,O,A);C<U||(R*=C=1/C,O*=C,A*=C,i=Math.sin(n),o=1-(s=Math.cos(n)),a=e[0],u=e[1],c=e[2],h=e[3],l=e[4],f=e[5],d=e[6],y=e[7],p=e[8],m=e[9],v=e[10],g=e[11],w=R*R*o+s,b=O*R*o+A*i,_=A*R*o-O*i,k=R*O*o-A*i,T=O*O*o+s,S=A*O*o+R*i,M=R*A*o+O*i,E=O*A*o-R*i,x=A*A*o+s,t[0]=a*w+l*b+p*_,t[1]=u*w+f*b+m*_,t[2]=c*w+d*b+v*_,t[3]=h*w+y*b+g*_,t[4]=a*k+l*T+p*S,t[5]=u*k+f*T+m*S,t[6]=c*k+d*T+v*S,t[7]=h*k+y*T+g*S,t[8]=a*M+l*E+p*x,t[9]=u*M+f*E+m*x,t[10]=c*M+d*E+v*x,t[11]=h*M+y*E+g*x,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?W(this,this,t):W(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return function(t,e,n){var r,i,s,o,a,u,c,h,l,f,d,y,p=n[0],m=n[1],v=n[2];e===t?(t[12]=e[0]*p+e[4]*m+e[8]*v+e[12],t[13]=e[1]*p+e[5]*m+e[9]*v+e[13],t[14]=e[2]*p+e[6]*m+e[10]*v+e[14],t[15]=e[3]*p+e[7]*m+e[11]*v+e[15]):(r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],d=e[10],y=e[11],t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=c,t[7]=h,t[8]=l,t[9]=f,t[10]=d,t[11]=y,t[12]=r*p+a*m+l*v+e[12],t[13]=i*p+u*m+f*v+e[13],t[14]=s*p+c*m+d*v+e[14],t[15]=o*p+h*m+y*v+e[15])}(this,this,t),this.check()}},{key:"transform",value:function(t,e){return 4===t.length?(N(e=function(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}},{key:"transformAsPoint",value:function(t,e){switch(t.length){case 2:e=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(e||[-0,-0],t,this);break;case 3:e=et(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return N(e,t.length),e}},{key:"transformAsVector",value:function(t,e){switch(t.length){case 2:e=function(t,e,n){var r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}(e||[-0,-0],t,this);break;case 3:e=z(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return N(e,t.length),e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,n){return this.identity().translate([t,e,n])}},{key:"transformPoint",value:function(t,e){return D("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}},{key:"transformVector",value:function(t,e){return D("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}},{key:"transformDirection",value:function(t,e){return D("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}],[{key:"_computeInfinitePerspectiveOffCenter",value:function(t,e,n,r,i,s){var o=2*s/(n-e),a=2*s/(i-r),u=(n+e)/(n-e),c=(i+r)/(i-r),h=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=u,t[9]=c,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}}]),n}(j);function dt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=y(t);if(e){var i=y(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d(this,n)}}var yt=function(t){l(n,t);var e=dt(n);function n(){return a(this,n),e.apply(this,arguments)}return c(n,[{key:"copy",value:function(t){return g(!1),this}},{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n){var r=this[n]-t[n];e+=r*r}return C(e)}},{key:"dot",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return C(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var s=i[r],o=0;o<this.ELEMENTS;++o)this[o]*=s[o];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var s=i[r],o=0;o<this.ELEMENTS;++o)this[o]/=s[o];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return g(t>=0&&t<this.ELEMENTS,"index is out of range"),C(this[t])}},{key:"setComponent",value:function(t,e){return g(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}},{key:"x",get:function(){return this[0]},set:function(t){this[0]=C(t)}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=C(t)}}]),n}(L);function pt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=y(t);if(e){var i=y(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d(this,n)}}var mt=[0,0,0],vt={},gt=function(t){l(n,t);var e=pt(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return a(this,n),t=e.call(this,-0,-0,-0),1===arguments.length&&S(r)?t.copy(r):(_.debug&&(C(r),C(i),C(s)),t[0]=r,t[1]=i,t[2]=s),t}return c(n,null,[{key:"ZERO",get:function(){return vt.ZERO=vt.ZERO||Object.freeze(new n(0,0,0,0))}}]),c(n,[{key:"set",value:function(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}},{key:"fromObject",value:function(t){return _.debug&&(C(t.x),C(t.y),C(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}},{key:"angle",value:function(t){return n=t,r=(e=this)[0],i=e[1],s=e[2],o=n[0],a=n[1],u=n[2],c=Math.sqrt(r*r+i*i+s*s)*Math.sqrt(o*o+a*a+u*u),h=c&&J(e,n)/c,Math.acos(Math.min(Math.max(h,-1),1));var e,n,r,i,s,o,a,u,c,h}},{key:"cross",value:function(t){return tt(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,n=t.origin;return function(t,e,n,r){var i=[],s=[];i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2]}(this,this,void 0===n?mt:n,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,n=t.origin;return function(t,e,n,r){var i=[],s=[];i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2]}(this,this,void 0===n?mt:n,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,n=t.origin;return function(t,e,n,r){var i=[],s=[];i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2]}(this,this,void 0===n?mt:n,e),this.check()}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return et(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return z(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return nt(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return function(t,e,n){var r=e[0],i=e[1];t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2]}(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return function(t,e,n){var r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],u=e[1],c=e[2],h=i*c-s*u,l=s*a-r*c,f=r*u-i*a,d=i*f-s*l,y=s*h-r*f,p=r*l-i*h,m=2*o;h*=m,l*=m,f*=m,d*=2,y*=2,p*=2,t[0]=a+h+d,t[1]=u+l+y,t[2]=c+f+p}(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=C(t)}}]),n}(yt),wt=.1,bt=1e-12,_t=1e-15,kt=(Math.PI,Math.PI,Math.PI,Math.PI,Math.max(6378137,6378137,6356752.314245179),function(t){return t}),Tt=new gt;function St(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kt;return S(t)?(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]):"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z),e}function Mt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tt;return St(t,e,_._cartographicRadians?kt:E)}function Et(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kt;return S(e)?(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]):"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]),e}function xt(t,e){return Et(t,e,_._cartographicRadians?kt:x)}var Rt=new gt,Ot=new gt,At=new gt;var Ct=new gt,Nt={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Pt={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Dt={east:new gt,north:new gt,up:new gt,west:new gt,south:new gt,down:new gt},It=new gt,qt=new gt,Lt=new gt;function Vt(t,e,n,r,i,s){var o,a,u,c=Nt[e]&&Nt[e][n];g(c&&(!r||r===c));var h=Ct.copy(i);if(O(h.x,0,1e-14)&&O(h.y,0,1e-14)){var l=Math.sign(h.z);o=It.fromArray(Pt[e]),"east"!==e&&"west"!==e&&o.scale(l),a=qt.fromArray(Pt[n]),"east"!==n&&"west"!==n&&a.scale(l),u=Lt.fromArray(Pt[r]),"east"!==r&&"west"!==r&&u.scale(l)}else{var f=Dt.up,d=Dt.east,y=Dt.north;d.set(-h.y,h.x,0).normalize(),t.geodeticSurfaceNormal(h,f),y.copy(f).cross(d);var p=Dt.west,m=Dt.south;Dt.down.copy(f).scale(-1),p.copy(d).scale(-1),m.copy(y).scale(-1),o=Dt[e],a=Dt[n],u=Dt[r]}return s[0]=o.x,s[1]=o.y,s[2]=o.z,s[3]=0,s[4]=a.x,s[5]=a.y,s[6]=a.z,s[7]=0,s[8]=u.x,s[9]=u.y,s[10]=u.z,s[11]=0,s[12]=h.x,s[13]=h.y,s[14]=h.z,s[15]=1,s}var jt,zt=new gt,Ut=new gt,Ft=new gt,Bt=new gt,Wt=new gt,$t=new gt,Gt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;a(this,t),g(e>=0),g(n>=0),g(r>=0),this.radii=new gt(e,n,r),this.radiiSquared=new gt(e*e,n*n,r*r),this.radiiToTheFourth=new gt(e*e*e*e,n*n*n*n,r*r*r*r),this.oneOverRadii=new gt(0===e?0:1/e,0===n?0:1/n,0===r?0:1/r),this.oneOverRadiiSquared=new gt(0===e?0:1/(e*e),0===n?0:1/(n*n),0===r?0:1/(r*r)),this.minimumRadius=Math.min(e,n,r),this.maximumRadius=Math.max(e,n,r),this.centerToleranceSquared=wt,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return c(t,null,[{key:"WGS84",get:function(){return jt=jt||new t(6378137,6378137,6356752.314245179)}}]),c(t,[{key:"equals",value:function(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=Ut,r=Ft,i=o(t,3),s=i[2];this.geodeticSurfaceNormalCartographic(t,n),r.copy(this.radiiSquared).scale(n);var a=Math.sqrt(n.dot(r));return r.scale(1/a),n.scale(s),r.add(n),r.to(e)}},{key:"cartesianToCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];$t.from(t);var n=this.scaleToGeodeticSurface($t,Bt);if(n){var r=this.geodeticSurfaceNormal(n,Ut),i=Wt;i.copy($t).subtract(n);var s=Math.atan2(r.y,r.x),o=Math.asin(r.z),a=Math.sign(J(i,$t))*X(i);return xt([s,o,a],e)}}},{key:"eastNorthUpToFixedFrame",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ft;return Vt(this,"east","north","up",t,e)}},{key:"localFrameToFixedFrame",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new ft;return Vt(this,t,e,n,r,i)}},{key:"geocentricSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return zt.from(t).normalize().to(e)}},{key:"geodeticSurfaceNormalCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=Mt(t),r=n[0],i=n[1],s=Math.cos(i);return zt.set(s*Math.cos(r),s*Math.sin(r),Math.sin(i)).normalize(),zt.to(e)}},{key:"geodeticSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return zt.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}},{key:"scaleToGeodeticSurface",value:function(t,e){return function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new gt,r=e.oneOverRadii,i=e.oneOverRadiiSquared,s=e.centerToleranceSquared;Rt.from(t);var o=t.x,a=t.y,u=t.z,c=r.x,h=r.y,l=r.z,f=o*o*c*c,d=a*a*h*h,y=u*u*l*l,p=f+d+y,m=Math.sqrt(1/p);if(Number.isFinite(m)){var v=Ot;if(v.copy(t).scale(m),p<s)return v.to(n);var g=i.x,w=i.y,b=i.z,_=At;_.set(v.x*g*2,v.y*w*2,v.z*b*2);var k,T,S,M,E=(1-m)*t.len()/(.5*_.len()),x=0;do{var R=(k=1/(1+(E-=x)*g))*k,O=(T=1/(1+E*w))*T,A=(S=1/(1+E*b))*S,C=R*k,N=O*T,P=A*S,D=f*C*g+d*N*w+y*P*b,I=-2*D;x=(M=f*R+d*O+y*A-1)/I}while(Math.abs(M)>bt);return Rt.scale([k,T,S]).to(n)}}(t,this,e)}},{key:"scaleToGeocentricSurface",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];Bt.from(t);var n=Bt.x,r=Bt.y,i=Bt.z,s=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*s.x+r*r*s.y+i*i*s.z);return Bt.multiplyScalar(o).to(e)}},{key:"transformPositionToScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Bt.from(t).scale(this.oneOverRadii).to(e)}},{key:"transformPositionFromScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Bt.from(t).scale(this.radii).to(e)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0];g(O(this.radii.x,this.radii.y,_t)),g(this.radii.z>0),Bt.from(t);var r=Bt.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-e))return Bt.set(0,0,r).to(n)}}]),t}(),Qt=n(3),Kt=function(){function t(e,n){a(this,t),this.name=e,this.type=n,this.sampleSize=1,this.reset()}return c(t,[{key:"setSampleSize",value:function(t){return this.sampleSize=t,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(t){return this._count+=t,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(t){return this._count-=t,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=Object(Qt.a)(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(Object(Qt.a)()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}(),Yt=function(){function t(e){var n=e.id,r=e.stats;a(this,t),this.id=n,this.stats={},this._initializeStats(r),Object.seal(this)}return c(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}},{key:"reset",value:function(){for(var t in this.stats)this.stats[t].reset();return this}},{key:"forEach",value:function(t){for(var e in this.stats)t(this.stats[e])}},{key:"getTable",value:function(){var t={};return this.forEach((function(e){t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}},{key:"_initializeStats",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach((function(e){return t._getOrCreate(e)}))}},{key:"_getOrCreate",value:function(t){if(!t||!t.name)return null;var e=t.name,n=t.type;return this.stats[e]||(this.stats[e]=t instanceof Kt?t:new Kt(e,n)),this.stats[e]}},{key:"size",get:function(){return Object.keys(this.stats).length}}]),t}();function Zt(t,e){if(!t)throw new Error(e||"loader assertion failed.")}function Xt(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(0,e):""}const Ht={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Jt{constructor(t={}){this.props={...Ht,...t},this.requestQueue=[],this.activeRequestCount=0,this.requestMap=new Map,this.stats=new Yt({id:t.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever"),this._deferredUpdate=null}scheduleRequest(t,e=(()=>0)){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const n={handle:t,getPriority:e},r=new Promise(t=>(n.resolve=t,n));return this.requestQueue.push(n),this.requestMap.set(t,r),this._issueNewRequests(),r}_issueRequest(t){const{handle:e,resolve:n}=t;let r=!1;const i=()=>{r||(r=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:i}):Promise.resolve({done:i})}_issueNewRequests(){this._deferredUpdate||(this._deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this._deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==t){this._updateAllRequests();for(let e=0;e<t;++e)if(this.requestQueue.length>0){const t=this.requestQueue.shift();this._issueRequest(t)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const n=t[e];this._updateRequest(n)||(t.splice(e,1),this.requestMap.delete(n.handle),e--)}t.sort((t,e)=>t.priority-e.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),!(t.priority<0)||(t.resolve(null),!1)}}class te{constructor(t,e,n){this.item=t,this.previous=e,this.next=n}}class ee{constructor(){this.head=null,this.tail=null,this._length=0}get length(){return this._length}add(t){const e=new te(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const n=t.next;t.next=e,this.tail===t?this.tail=e:n.previous=e,e.next=n,e.previous=t,++this._length}}function ne(t){return null!=t}class re{constructor(){this._list=new ee,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;ne(e)&&this._list.splice(this._sentinel,e)}add(t,e,n){ne(e._cacheNode)||(e._cacheNode=this._list.add(e),n&&n(t,e))}unloadTile(t,e,n){const r=e._cacheNode;ne(r)&&(this._list.remove(r),e._cacheNode=void 0,n&&n(t,e))}unloadTiles(t,e){const n=this._trimTiles;this._trimTiles=!1;const r=this._list,i=1024*t.maximumMemoryUsage*1024,s=this._sentinel;let o=r.head;for(;o!==s&&(t.gpuMemoryUsageInBytes>i||n);){const n=o.item;o=o.next,this.unloadTile(t,n,e)}}trim(){this._trimTiles=!0}}function ie(t,e){Zt(t),Zt(e);const{rtcCenter:n,gltfUpAxis:r}=e,{computedTransform:i,boundingVolume:{center:s}}=t;let o=new ft(i);switch(n&&o.translate(n),r){case"Z":break;case"Y":const t=(new ft).rotateX(Math.PI/2);o=o.multiplyRight(t);break;case"X":const e=(new ft).rotateY(-Math.PI/2);o=o.multiplyRight(e)}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new gt(s);e.cartesianModelMatrix=o,e.cartesianOrigin=a;const u=Gt.WGS84.cartesianToCartographic(a,new gt),c=Gt.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=c.multiplyRight(o),e.cartographicOrigin=u,e.modelMatrix=e.cartographicModelMatrix}var se=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1}),oe=new gt,ae=new gt,ue=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a(this,t),r=r||oe.copy(e).add(n).scale(.5),this.center=new gt(r),this.halfDiagonal=new gt(n).subtract(this.center),this.minimum=new gt(e),this.maximum=new gt(n)}c(t,[{key:"clone",value:function(){return new t(this.minimum,this.maximum,this.center)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}},{key:"intersectPlane",value:function(t){var e=this.halfDiagonal,n=ae.from(t.normal),r=e.x*Math.abs(n.x)+e.y*Math.abs(n.y)+e.z*Math.abs(n.z),i=this.center.dot(n)+t.distance;return i-r>0?se.INSIDE:i+r<0?se.OUTSIDE:se.INTERSECTING}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}},{key:"distanceSquaredTo",value:function(t){var e,n=oe.from(t).subtract(this.center),r=this.halfDiagonal,i=0;return(e=Math.abs(n.x)-r.x)>0&&(i+=e*e),(e=Math.abs(n.y)-r.y)>0&&(i+=e*e),(e=Math.abs(n.z)-r.z)>0&&(i+=e*e),i}}])}(),new gt),ce=new gt,he=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;a(this,t),this.radius=-0,this.center=new gt,this.fromCenterRadius(e,n)}return c(t,[{key:"fromCenterRadius",value:function(t,e){return this.center.from(t),this.radius=e,this}},{key:"fromCornerPoints",value:function(t,e){return e=ue.from(e),this.center=(new gt).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}},{key:"clone",value:function(){return new t(this.center,this.radius)}},{key:"union",value:function(t){var e=this.center,n=this.radius,r=t.center,i=t.radius,s=ue.copy(r).subtract(e),o=s.magnitude();if(n>=o+i)return this.clone();if(i>=o+n)return t.clone();var a=.5*(n+o+i);return ce.copy(s).scale((-n+a)/o).add(e),this.center.copy(ce),this.radius=a,this}},{key:"expand",value:function(t){var e=(t=ue.from(t)).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}},{key:"intersectPlane",value:function(t){var e=this.center,n=this.radius,r=t.normal.dot(e)+t.distance;return r<-n?se.OUTSIDE:r<n?se.INTERSECTING:se.INSIDE}},{key:"transform",value:function(t){this.center.transform(t);var e=$(ue,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}},{key:"distanceSquaredTo",value:function(t){return(t=ue.from(t)).subtract(this.center).lengthSquared()-this.radius*this.radius}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}}]),t}();function le(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=n[0],d=n[1],y=n[2],p=n[3],m=n[4],v=n[5],g=n[6],w=n[7],b=n[8];return t[0]=f*r+d*o+y*c,t[1]=f*i+d*a+y*h,t[2]=f*s+d*u+y*l,t[3]=p*r+m*o+v*c,t[4]=p*i+m*a+v*h,t[5]=p*s+m*u+v*l,t[6]=g*r+w*o+b*c,t[7]=g*i+w*a+b*h,t[8]=g*s+w*u+b*l,t}function fe(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function de(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=y(t);if(e){var i=y(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d(this,n)}}var ye=Object.freeze([1,0,0,0,1,0,0,0,1]),pe=Object.freeze([0,0,0,0,0,0,0,0,0]),me=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),ve={},ge=function(t){l(n,t);var e=de(n);function n(t){var r;return a(this,n),r=e.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?r.copy(t):r.identity(),r}return c(n,[{key:"ELEMENTS",get:function(){return 9}},{key:"RANK",get:function(){return 3}},{key:"INDICES",get:function(){return me}}],[{key:"IDENTITY",get:function(){return ve.IDENTITY=ve.IDENTITY||Object.freeze(new n(ye)),ve.IDENTITY}},{key:"ZERO",get:function(){return ve.ZERO=ve.ZERO||Object.freeze(new n(pe)),ve.ZERO}}]),c(n,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}},{key:"set",value:function(t,e,n,r,i,s,o,a,u){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this[4]=i,this[5]=s,this[6]=o,this[7]=a,this[8]=u,this.check()}},{key:"setRowMajor",value:function(t,e,n,r,i,s,o,a,u){return this[0]=t,this[1]=r,this[2]=o,this[3]=e,this[4]=i,this[5]=a,this[6]=n,this[7]=s,this[8]=u,this.check()}},{key:"determinant",value:function(){return e=(t=this)[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],u=t[7],c=t[8],e*(c*s-o*u)+n*(-c*i+o*a)+r*(u*i-s*a);var t,e,n,r,i,s,o,a,u,c}},{key:"identity",value:function(){return this.copy(ye)}},{key:"fromQuaternion",value:function(t){return function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,u=i+i,c=n*o,h=r*o,l=r*a,f=i*o,d=i*a,y=i*u,p=s*o,m=s*a,v=s*u;t[0]=1-l-y,t[3]=h-v,t[6]=f+m,t[1]=h+v,t[4]=1-c-y,t[7]=d-p,t[2]=f-m,t[5]=d+p,t[8]=1-c-l}(this,t),this.check()}},{key:"transpose",value:function(){return function(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],h=e[8],l=h*o-a*c,f=-h*s+a*u,d=c*s-o*u,y=n*l+r*f+i*d;y&&(y=1/y,t[0]=l*y,t[1]=(-h*r+i*c)*y,t[2]=(a*r-i*o)*y,t[3]=f*y,t[4]=(h*n-i*u)*y,t[5]=(-a*n+i*s)*y,t[6]=d*y,t[7]=(-c*n+r*u)*y,t[8]=(o*n-r*s)*y)}(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return le(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return le(this,this,t),this.check()}},{key:"rotate",value:function(t){return function(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=Math.sin(n),d=Math.cos(n);t[0]=d*r+f*o,t[1]=d*i+f*a,t[2]=d*s+f*u,t[3]=d*o-f*r,t[4]=d*a-f*i,t[5]=d*u-f*s,t[6]=c,t[7]=h,t[8]=l}(this,this,t),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?fe(this,this,t):fe(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return function(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=n[0],d=n[1];t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=f*r+d*o+c,t[7]=f*i+d*a+h,t[8]=f*s+d*u+l}(this,this,t),this.check()}},{key:"transform",value:function(t,e){switch(t.length){case 2:e=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}(e||[-0,-0],t,this);break;case 3:e=nt(e||[-0,-0,-0],t,this);break;case 4:e=function(t,e,n){var r=e[0],i=e[1],s=e[2];return t[0]=n[0]*r+n[3]*i+n[6]*s,t[1]=n[1]*r+n[4]*i+n[7]*s,t[2]=n[2]*r+n[5]*i+n[8]*s,t[3]=e[3],t}(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return N(e,t.length),e}},{key:"transformVector",value:function(t,e){return D("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector2",value:function(t,e){return D("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector3",value:function(t,e){return D("Matrix3.transformVector"),this.transform(t,e)}}]),n}(j);function we(){var t=new F(4);return F!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function be(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function _e(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=n[0],u=n[1],c=n[2],h=n[3];return t[0]=r*h+o*a+i*c-s*u,t[1]=i*h+o*u+s*a-r*c,t[2]=s*h+o*c+r*u-i*a,t[3]=o*h-r*a-i*u-s*c,t}function ke(t,e,n,r){var i,s,o,a,u,c=e[0],h=e[1],l=e[2],f=e[3],d=n[0],y=n[1],p=n[2],m=n[3];return(s=c*d+h*y+l*p+f*m)<0&&(s=-s,d=-d,y=-y,p=-p,m=-m),1-s>U?(i=Math.acos(s),o=Math.sin(i),a=Math.sin((1-r)*i)/o,u=Math.sin(r*i)/o):(a=1-r,u=r),t[0]=a*c+u*d,t[1]=a*h+u*y,t[2]=a*l+u*p,t[3]=a*f+u*m,t}function Te(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var s=(i+1)%3,o=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*o+o]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*s+o]-e[3*o+s])*n,t[s]=(e[3*s+i]+e[3*i+s])*n,t[o]=(e[3*o+i]+e[3*i+o])*n}return t}var Se,Me,Ee,xe,Re,Oe,Ae=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Ce=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Ne=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Pe=function(t,e,n,r){var i=e[0],s=e[1],o=e[2],a=e[3];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t[2]=o+r*(n[2]-o),t[3]=a+r*(n[3]-a),t},De=it,Ie=st,qe=function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=s*o,t},Le=(Se=Z(),Me=H(1,0,0),Ee=H(0,1,0),function(t,e,n){var r=J(e,n);return r<-.999999?(tt(Se,Me,e),rt(Se)<1e-6&&tt(Se,Ee,e),function(t,e){var n=e[0],r=e[1],i=e[2],s=n*n+r*r+i*i;s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s}(Se,Se),be(t,Se,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(tt(Se,e,n),t[0]=Se[0],t[1]=Se[1],t[2]=Se[2],t[3]=1+r,qe(t,t))});xe=we(),Re=we(),Oe=function(){var t=new F(9);return F!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}();function Ve(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=y(t);if(e){var i=y(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d(this,n)}}var je=[0,0,0,1],ze=function(t){l(n,t);var e=Ve(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return a(this,n),t=e.call(this,-0,-0,-0,-0),Array.isArray(r)&&1===arguments.length?t.copy(r):t.set(r,i,s,o),t}return c(n,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}},{key:"set",value:function(t,e,n,r){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this.check()}},{key:"fromMatrix3",value:function(t){return Te(this,t),this.check()}},{key:"identity",value:function(){return function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}(this),this.check()}},{key:"fromAxisRotation",value:function(t,e){return be(this,t,e),this.check()}},{key:"setAxisAngle",value:function(t,e){return this.fromAxisRotation(t,e)}},{key:"len",value:function(){return De(this)}},{key:"lengthSquared",value:function(){return Ie(this)}},{key:"dot",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.dot only takes one argument");return Ne(this,t)}},{key:"rotationTo",value:function(t,e){return Le(this,t,e),this.check()}},{key:"add",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.add only takes one argument");return Ae(this,this,t),this.check()}},{key:"calculateW",value:function(){return function(t,e){var n=e[0],r=e[1],i=e[2];t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i))}(this,this),this.check()}},{key:"conjugate",value:function(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n*n+r*r+i*i+s*s,a=o?1/o:0;t[0]=-n*a,t[1]=-r*a,t[2]=-i*a,t[3]=s*a}(this,this),this.check()}},{key:"lerp",value:function(t,e,n){return Pe(this,t,e,n),this.check()}},{key:"multiplyRight",value:function(t,e){return g(!e),_e(this,this,t),this.check()}},{key:"multiplyLeft",value:function(t,e){return g(!e),_e(this,t,this),this.check()}},{key:"normalize",value:function(){var t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}},{key:"rotateX",value:function(t){return function(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),u=Math.cos(n);t[0]=r*u+o*a,t[1]=i*u+s*a,t[2]=s*u-i*a,t[3]=o*u-r*a}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),u=Math.cos(n);t[0]=r*u-s*a,t[1]=i*u+o*a,t[2]=s*u+r*a,t[3]=o*u-i*a}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),u=Math.cos(n);t[0]=r*u+i*a,t[1]=i*u-r*a,t[2]=s*u+o*a,t[3]=o*u-s*a}(this,this,t),this.check()}},{key:"scale",value:function(t){return Ce(this,this,t),this.check()}},{key:"slerp",value:function(t,e,n){switch(arguments.length){case 1:var r=arguments[0],i=r.start;t=void 0===i?je:i,e=r.target,n=r.ratio;break;case 2:var s=Array.prototype.slice.call(arguments);e=s[0],n=s[1],t=this}return ke(this,t,e,n),this.check()}},{key:"transformVector4",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return ot(e,t,this),N(e,4)}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"setFromAxisAngle",value:function(t,e){return this.setAxisAngle(t,e)}},{key:"premultiply",value:function(t,e){return this.multiplyLeft(t,e)}},{key:"multiply",value:function(t,e){return this.multiplyRight(t,e)}},{key:"ELEMENTS",get:function(){return 4}},{key:"x",get:function(){return this[0]},set:function(t){this[0]=C(t)}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=C(t)}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=C(t)}},{key:"w",get:function(){return this[3]},set:function(t){this[3]=C(t)}}]),n}(L),Ue=new gt,Fe=new gt,Be=new gt,We=new gt,$e=new gt,Ge=new gt,Qe=new gt,Ke=new gt,Ye=new gt,Ze=new gt,Xe=0,He=1,Je=2,tn=3,en=4,nn=5,rn=6,sn=7,on=8,an=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0,0,0,0,0,0];a(this,t),this.center=(new gt).from(e),this.halfAxes=new ge(n)}return c(t,[{key:"fromCenterHalfSizeQuaternion",value:function(t,e,n){var r=new ze(n),i=(new ge).fromQuaternion(r);return i[0]=i[0]*e[0],i[1]=i[1]*e[0],i[2]=i[2]*e[0],i[3]=i[3]*e[1],i[4]=i[4]*e[1],i[5]=i[5]*e[1],i[6]=i[6]*e[2],i[7]=i[7]*e[2],i[8]=i[8]*e[2],this.center=(new gt).from(t),this.halfAxes=i,this}},{key:"clone",value:function(){return new t(this.center,this.halfAxes)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new he,e=this.halfAxes,n=e.getColumn(0,Ke),r=e.getColumn(1,Ye),i=e.getColumn(2,Ze),s=Ue.copy(n).add(r).add(i);return t.center.copy(this.center),t.radius=s.magnitude(),t}},{key:"intersectPlane",value:function(t){var e=this.center,n=t.normal,r=this.halfAxes,i=n.x,s=n.y,o=n.z,a=Math.abs(i*r[Xe]+s*r[He]+o*r[Je])+Math.abs(i*r[tn]+s*r[en]+o*r[nn])+Math.abs(i*r[rn]+s*r[sn]+o*r[on]),u=n.dot(e)+t.distance;return u<=-a?se.OUTSIDE:u>=a?se.INSIDE:se.INTERSECTING}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}},{key:"distanceSquaredTo",value:function(t){var e=Fe.from(t).subtract(this.center),n=this.halfAxes,r=n.getColumn(0,Be),i=n.getColumn(1,We),s=n.getColumn(2,$e),o=r.magnitude(),a=i.magnitude(),u=s.magnitude();r.normalize(),i.normalize(),s.normalize();var c,h=0;return(c=Math.abs(e.dot(r))-o)>0&&(h+=c*c),(c=Math.abs(e.dot(i))-a)>0&&(h+=c*c),(c=Math.abs(e.dot(s))-u)>0&&(h+=c*c),h}},{key:"computePlaneDistances",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[-0,-0],r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,s=this.center,o=this.halfAxes,a=o.getColumn(0,Be),u=o.getColumn(1,We),c=o.getColumn(2,$e),h=Ge.copy(a).add(u).add(c).add(s),l=Qe.copy(h).subtract(t),f=e.dot(l);return r=Math.min(f,r),i=Math.max(f,i),h.copy(s).add(a).add(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),r=Math.min(f,r),i=Math.max(f,i),h.copy(s).add(a).subtract(u).add(c),l.copy(h).subtract(t),f=e.dot(l),r=Math.min(f,r),i=Math.max(f,i),h.copy(s).add(a).subtract(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),r=Math.min(f,r),i=Math.max(f,i),s.copy(h).subtract(a).add(u).add(c),l.copy(h).subtract(t),f=e.dot(l),r=Math.min(f,r),i=Math.max(f,i),s.copy(h).subtract(a).add(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),r=Math.min(f,r),i=Math.max(f,i),s.copy(h).subtract(a).subtract(u).add(c),l.copy(h).subtract(t),f=e.dot(l),r=Math.min(f,r),i=Math.max(f,i),s.copy(h).subtract(a).subtract(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),r=Math.min(f,r),i=Math.max(f,i),n[0]=r,n[1]=i,n}},{key:"getTransform",value:function(){}},{key:"halfSize",get:function(){var t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new gt(t).len(),new gt(e).len(),new gt(n).len()]}},{key:"quaternion",get:function(){var t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),r=new gt(t).normalize(),i=new gt(e).normalize(),s=new gt(n).normalize();return(new ze).fromMatrix3(new ge([].concat(v(r),v(i),v(s))))}}]),t}(),un=new gt,cn=new gt,hn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,1],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;a(this,t),this.normal=new gt,this.distance=-0,this.fromNormalDistance(e,n)}return c(t,[{key:"fromNormalDistance",value:function(t,e){return g(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}},{key:"fromPointNormal",value:function(t,e){t=un.from(t),this.normal.from(e).normalize();var n=-this.normal.dot(t);return this.distance=n,this}},{key:"fromCoefficients",value:function(t,e,n,r){return this.normal.set(t,e,n),g(O(this.normal.len(),1)),this.distance=r,this}},{key:"clone",value:function(e){return new t(this.normal,this.distance)}},{key:"equals",value:function(t){return O(this.distance,t.distance)&&O(this.normal,t.normal)}},{key:"getPointDistance",value:function(t){return this.normal.dot(t)+this.distance}},{key:"transform",value:function(t){var e=cn.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,e)}},{key:"projectPointOntoPlane",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];t=un.from(t);var n=this.getPointDistance(t),r=cn.copy(this.normal).scale(n);return t.subtract(r).to(e)}}]),t}();function ln(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return fn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fn(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){a=!0,s=t},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw s}}}}function fn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var dn=[new gt([1,0,0]),new gt([0,1,0]),new gt([0,0,1])],yn=new gt,pn=new gt,mn=(new hn(new gt(1,0,0),0),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];a(this,t),this.planes=e,g(this.planes.every((function(t){return t instanceof hn})))}return c(t,null,[{key:"MASK_OUTSIDE",get:function(){return 4294967295}},{key:"MASK_INSIDE",get:function(){return 0}},{key:"MASK_INDETERMINATE",get:function(){return 2147483647}}]),c(t,[{key:"fromBoundingSphere",value:function(t){this.planes.length=2*dn.length;var e,n=t.center,r=t.radius,i=0,s=ln(dn);try{for(s.s();!(e=s.n()).done;){var o=e.value,a=this.planes[i],u=this.planes[i+1];a||(a=this.planes[i]=new hn),u||(u=this.planes[i+1]=new hn);var c=yn.copy(o).scale(-r).add(n);o.dot(c);a.fromPointNormal(c,o);var h=yn.copy(o).scale(r).add(n),l=pn.copy(o).negate();l.dot(h);u.fromPointNormal(h,l),i+=2}}catch(t){s.e(t)}finally{s.f()}return this}},{key:"computeVisibility",value:function(t){g(t);var e,n=se.INSIDE,r=ln(this.planes);try{for(r.s();!(e=r.n()).done;){var i=e.value;switch(t.intersectPlane(i)){case se.OUTSIDE:return se.OUTSIDE;case se.INTERSECTING:n=se.INTERSECTING}}}catch(t){r.e(t)}finally{r.f()}return n}},{key:"computeVisibilityWithPlaneMask",value:function(e,n){if(g(e,"boundingVolume is required."),g(Number.isFinite(n),"parentPlaneMask is required."),n===t.MASK_OUTSIDE||n===t.MASK_INSIDE)return n;for(var r=t.MASK_INSIDE,i=this.planes,s=0;s<this.planes.length;++s){var o=s<31?1<<s:0;if(!(s<31&&0==(n&o))){var a=i[s],u=e.intersectPlane(a);if(u===se.OUTSIDE)return t.MASK_OUTSIDE;u===se.INTERSECTING&&(r|=o)}}return r}}]),t}());function vn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function gn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function wn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?gn(Object(n),!0).forEach((function(e){vn(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var bn=new gt,_n=new gt,kn=new gt,Tn=new gt,Sn=new gt,Mn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,t),e=wn({near:1,far:5e8},e),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this._cullingVolume=new mn([new hn,new hn,new hn,new hn,new hn,new hn]),this._perspectiveMatrix=new ft,this._infinitePerspective=new ft}return c(t,[{key:"clone",value:function(){return new t({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}},{key:"equals",value:function(e){return e&&e instanceof t&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far}},{key:"computeCullingVolume",value:function(t,e,n){g(t,"position is required."),g(e,"direction is required."),g(n,"up is required.");var r=this._cullingVolume.planes;n=bn.copy(n).normalize();var i=_n.copy(e).cross(n).normalize(),s=kn.copy(e).multiplyByScalar(this.near).add(t),o=Tn.copy(e).multiplyByScalar(this.far).add(t),a=Sn;return a.copy(i).multiplyByScalar(this.left).add(s).subtract(t).cross(n),r[0].fromPointNormal(t,a),a.copy(i).multiplyByScalar(this.right).add(s).subtract(t).cross(n).negate(),r[1].fromPointNormal(t,a),a.copy(n).multiplyByScalar(this.bottom).add(s).subtract(t).cross(i).negate(),r[2].fromPointNormal(t,a),a.copy(n).multiplyByScalar(this.top).add(s).subtract(t).cross(i),r[3].fromPointNormal(t,a),a=(new gt).copy(e),r[4].fromPointNormal(s,a),a.negate(),r[5].fromPointNormal(o,a),this._cullingVolume}},{key:"getPixelDimensions",value:function(t,e,n,r){En(this),g(Number.isFinite(t)&&Number.isFinite(e)),g(t>0),g(e>0),g(n>0),g(r);var i=1/this.near,s=this.top*i,o=2*n*s/e,a=2*n*(s=this.right*i)/t;return r.x=a,r.y=o,r}},{key:"projectionMatrix",get:function(){return En(this),this._perspectiveMatrix}},{key:"infiniteProjectionMatrix",get:function(){return En(this),this._infinitePerspective}}]),t}();function En(t){g(Number.isFinite(t.right)&&Number.isFinite(t.left)&&Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t.top,n=t.bottom,r=t.right,i=t.left,s=t.near,o=t.far;e===t._top&&n===t._bottom&&i===t._left&&r===t._right&&s===t._near&&o===t._far||(g(t.near>0&&t.near<t.far,"near must be greater than zero and less than far."),t._left=i,t._right=r,t._top=e,t._bottom=n,t._near=s,t._far=o,t._perspectiveMatrix=(new ft).frustum({left:i,right:r,bottom:n,top:e,near:s,far:o}),t._infinitePerspective=(new ft).frustum({left:i,right:r,bottom:n,top:e,near:s,far:1/0}))}function xn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Rn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?xn(Object(n),!0).forEach((function(e){vn(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}!function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,t),e=Rn({near:1,far:5e8,xOffset:0,yOffset:0},e),this._offCenterFrustum=new Mn,this.fov=e.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this.xOffset=e.xOffset,this._xOffset=this.xOffset,this.yOffset=e.yOffset,this._yOffset=this.yOffset}c(t,[{key:"clone",value:function(){return new t({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}},{key:"equals",value:function(e){return null!=e&&e instanceof t&&(On(this),On(e),this.fov===e.fov&&this.aspectRatio===e.aspectRatio&&this.near===e.near&&this.far===e.far&&this._offCenterFrustum.equals(e._offCenterFrustum))}},{key:"computeCullingVolume",value:function(t,e,n){return On(this),this._offCenterFrustum.computeCullingVolume(t,e,n)}},{key:"getPixelDimensions",value:function(t,e,n,r){return On(this),this._offCenterFrustum.getPixelDimensions(t,e,n,r)}},{key:"projectionMatrix",get:function(){return On(this),this._offCenterFrustum.projectionMatrix}},{key:"infiniteProjectionMatrix",get:function(){return On(this),this._offCenterFrustum.infiniteProjectionMatrix}},{key:"fovy",get:function(){return On(this),this._fovy}},{key:"sseDenominator",get:function(){return On(this),this._sseDenominator}}])}();function On(t){g(Number.isFinite(t.fov)&&Number.isFinite(t.aspectRatio)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t._offCenterFrustum;t.fov===t._fov&&t.aspectRatio===t._aspectRatio&&t.near===t._near&&t.far===t._far&&t.xOffset===t._xOffset&&t.yOffset===t._yOffset||(g(t.fov>=0&&t.fov<Math.PI),g(t.aspectRatio>0),g(t.near>=0&&t.near<t.far),t._aspectRatio=t.aspectRatio,t._fov=t.fov,t._fovy=t.aspectRatio<=1?t.fov:2*Math.atan(Math.tan(.5*t.fov)/t.aspectRatio),t._near=t.near,t._far=t.far,t._sseDenominator=2*Math.tan(.5*t._fovy),t._xOffset=t.xOffset,t._yOffset=t.yOffset,e.top=t.near*Math.tan(.5*t._fovy),e.bottom=-e.top,e.right=t.aspectRatio*e.top,e.left=-e.right,e.near=t.near,e.far=t.far,e.right+=t.xOffset,e.left+=t.xOffset,e.top+=t.yOffset,e.bottom+=t.yOffset)}new gt,new gt,new gt,new gt,new gt,new gt,new gt,new gt,new gt,new gt,new gt,new gt,Math.PI;new ge,new ge,new ge,new ge,new ge;new gt,new gt,new gt,new gt,new gt,new ge,new ge,new ge;const An=new gt,Cn=new gt,Nn=new mn([new hn,new hn,new hn,new hn,new hn,new hn]);function Pn(t,e){const{cameraDirection:n,cameraUp:r,height:i}=t,{metersPerUnit:s}=t.distanceScales,o=[t.longitude,t.latitude,0],a=Gt.WGS84.cartographicToCartesian(o,new gt),u=Gt.WGS84.eastNorthUpToFixedFrame(a),c=t.unprojectPosition(t.cameraPosition),h=Gt.WGS84.cartographicToCartesian(c,new gt),l=new gt(u.transformAsVector(new gt(n).scale(s))).normalize(),f=new gt(u.transformAsVector(new gt(r).scale(s))).normalize();return function(t,e){const n=t.getFrustumPlanes();let r=0;for(const i in n){const s=n[i],o=s.normal.dot(t.center);Cn.copy(s.normal).scale(s.distance-o).add(t.center);const a=t.unprojectPosition(Cn),u=Gt.WGS84.cartographicToCartesian(a,new gt);Nn.planes[r++].fromPointNormal(u,An.copy(e).subtract(u))}}(t,a),{camera:{position:h,direction:l,up:f},viewport:t,height:i,cullingVolume:Nn,frameNumber:e,sseDenominator:1.15}}const Dn=new gt;const In=t=>"boolean"==typeof t,qn=t=>"function"==typeof t,Ln=t=>null!==t&&"object"==typeof t,Vn=t=>Ln(t)&&t.constructor==={}.constructor,jn=t=>t&&"function"==typeof t[Symbol.iterator],zn=t=>t&&"function"==typeof t[Symbol.asyncIterator],Un=t=>"undefined"!=typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Fn=t=>"undefined"!=typeof Blob&&t instanceof Blob,Bn=t=>(t=>"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||Ln(t)&&qn(t.tee)&&qn(t.cancel)&&qn(t.getReader))(t)||(t=>Ln(t)&&qn(t.read)&&qn(t.pipe)&&In(t.readable))(t);function Wn(t){if(!t)return!1;Array.isArray(t)&&(t=t[0]);let e=t.parseTextSync||t.parseSync||t.parse||t.parseStream||t.parseInBatches;const n=t.options&&t.options[t.id];return e=e||n&&n.workerUrl,e}function $n(t){let e;return Zt(t,"null loader"),Zt(Wn(t),"invalid loader"),Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),t.extension&&(t.extensions=t.extensions||t.extension,delete t.extension),Array.isArray(t.extensions)||(t.extensions=[t.extensions]),Zt(t.extensions&&t.extensions.length>0&&t.extensions[0]),(t.parseTextSync||t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}var Gn=n(1);let Qn="";const Kn={};const Yn=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Zn=/^([-\w.]+\/[-\w.+]+)/;function Xn(t){if("string"!=typeof t)return"";const e=t.match(Yn);return e?e[1]:""}const Hn=/\?.*/;function Jn(t){if(Un(t)){const e=function(t){if("string"!=typeof t)return"";const e=t.match(Zn);return e?e[1]:t}(t.headers.get("content-type")),n=Xn(t.url);return{url:tr(t.url||""),type:e||n||null}}return Fn(t)?{url:tr(t.name||""),type:t.type||""}:"string"==typeof t?{url:tr(t),type:Xn(t)}:{url:"",type:""}}function tr(t){return t.replace(Hn,"")}async function er(t){if(Un(t))return t;const e={},n=function(t){return Un(t)?t.headers["content-length"]||-1:Fn(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}(t);n>=0&&(e["content-length"]=String(n));const{url:r,type:i}=Jn(t);i&&(e["content-type"]=i);const s=await async function(t){if("string"==typeof t)return"data:,"+t.slice(0,5);if(t instanceof Blob){const e=t.slice(0,5);return await new Promise(t=>{const n=new FileReader;n.onload=e=>t(e.target&&e.target.result),n.readAsDataURL(e)})}if(t instanceof ArrayBuffer){const e=t.slice(0,5);return"data:base64,"+function(t){let e="";const n=new Uint8Array(t);for(let t=0;t<n.byteLength;t++)e+=String.fromCharCode(n[t]);return btoa(e)}(e)}return null}(t);s&&(e["x-first-bytes"]=s),"string"==typeof t&&(t=(new TextEncoder).encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function nr(t){if(!t.ok){const e=await async function(t){let e=`Failed to fetch resource ${t.url} (${t.status}): `;try{const n=t.headers.get("Content-Type");let r=t.statusText;n.includes("application/json")&&(r+=" "+await t.text()),e+=r,e=e.length>60?e.slice(60)+"...":e}catch(t){}return e}(t);throw new Error(e)}}async function rr(t,e={}){if("string"!=typeof t)return await er(t);t=function(t){for(const e in Kn)if(t.startsWith(e)){const n=Kn[e];t=t.replace(e,n)}return t.startsWith("http://")||t.startsWith("https://")||(t=`${Qn}${t}`),t}(t);const n=await fetch(t,e);if(!n.ok&&e.throws)throw new Error(await async function(t){let e=`Failed to fetch resource ${t.url} (${t.status}): `;try{t.headers.get("Content-Type").includes("application/json")?e+=await t.text():e+=t.statusText}catch(t){return e}return e}(n));return n}class ir{log(){return t=>{}}info(){return t=>{}}warn(){return t=>{}}error(){return t=>{}}}const sr={fetch:null,CDN:"https://unpkg.com/@loaders.gl",worker:!0,log:new class{constructor(){this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}},metadata:!1,transforms:[]},or={dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"},ar=()=>{Gn.a.loaders=Gn.a.loaders||{};const{loaders:t}=Gn.a;return t._state=t._state||{},t._state},ur=()=>{const t=ar();return t.globalOptions=t.globalOptions||{...sr},t.globalOptions};function cr(t,e,n,r){return n=n||[],function(t,e,n=console){lr(t,null,n,sr,or,e);for(const r of e){const i=t&&t[r.id]||{},s=r.options&&r.options[r.id]||{},o=r.defaultOptions&&r.defaultOptions[r.id]||{};lr(i,r.id,n,s,o,e)}}(t,n=Array.isArray(n)?n:[n]),dr(e,t,r)}function hr(t,e){const n=ur(),r=t.fetch||n.fetch;return"function"==typeof r?r:Ln(r)?t=>rr(t,r):e&&e.fetch?e.fetch:e=>rr(e,t)}function lr(t,e,n,r,i,s){const o=e||"Top level",a=e?e+".":"";for(const u in t){const c=!e&&Ln(t[u]);if(!(u in r))if(u in i)n.warn(`${o} loader option '${a}${u}' deprecated, use '${i[u]}'`);else if(!c){const t=fr(u,s);n.warn(`${o} loader option '${a}${u}' not recognized. ${t}`)}}}function fr(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const e in i.options){if(t===e)return`Did you mean '${i.id}.${e}'?`;const s=e.toLowerCase();(n.startsWith(s)||s.startsWith(n))&&(r=r||`Did you mean '${i.id}.${e}'?`)}return r}function dr(t,e,n){const r={...t.options||{}};return function(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}(r,n),null===r.log&&(r.log=new ir),yr(r,ur()),yr(r,e),r}function yr(t,e){for(const n in e)if(n in e){const r=e[n];Vn(r)&&Vn(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function pr(t){const e=t.split(".").map(Number);return{major:e[0],minor:e[1]}}var mr=n(7);function vr(t){if(mr.toArrayBuffer&&(t=mr.toArrayBuffer(t)),t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.buffer;if("string"==typeof t){const e=t;return(new TextEncoder).encode(e).buffer}return t&&"object"==typeof t&&t._toArrayBuffer?t._toArrayBuffer():Zt(!1)}async function gr(t){const e=[],n=[];for await(const r of t)"string"==typeof r?n.push(r):e.push(r);return n.length>0?(Zt(0===e.length),n.join("")):function(...t){const e=t.map(t=>t instanceof ArrayBuffer?new Uint8Array(t):t),n=e.reduce((t,e)=>t+e.byteLength,0),r=new Uint8Array(n);let i=0;for(const t of e)r.set(t,i),i+=t.byteLength;return r.buffer}(...e)}async function wr(t,e,n){return await new Promise((r,i)=>{const s=t.slice(e,n),o=new FileReader;o.onload=t=>r(t.target&&t.target.result),o.onerror=t=>i(t),o.readAsArrayBuffer(s)})}function br(t){if(Gn.b||Gn.c>=10){if("function"==typeof t[Symbol.asyncIterator])return async function*(t){for await(const e of t)yield vr(e)}(t);if("function"==typeof t.getIterator)return t.getIterator()}return Gn.b?async function*(t){const e=t.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)return;yield vr(n)}}catch(t){e.releaseLock()}}(t):async function*(t){t=await t;for(;;){const e=t.read();if(null===e){if(t._readableState.ended)return;await _r(t)}else yield vr(e)}}(t)}async function _r(t){return new Promise(e=>{t.once("readable",e)})}function kr(t,e={}){return"string"==typeof t?function*(t,e={}){const{chunkSize:n=262144}=e;let r=0;const i=new TextEncoder;for(;r<t.length;){const e=Math.min(t.length-r,n),s=t.slice(r,r+e);r+=e,yield i.encode(s)}}(t,e):t instanceof ArrayBuffer?function*(t,e={}){const{chunkSize:n=262144}=e;let r=0;for(;r<t.byteLength;){const e=Math.min(t.byteLength-r,n),i=new ArrayBuffer(e),s=new Uint8Array(t,r,e);new Uint8Array(i).set(s),r+=e,yield i}}(t,e):Fn(t)?async function*(t,e={}){const n=e.chunkSize||1048576;let r=0;for(;r<t.size;){const e=r+n,i=await wr(t,r,e);r=e,yield i}}(t,e):Bn(t)?br(t):Un(t)?br(t.body):Zt(!1)}const Tr="Cannot convert supplied data type";async function Sr(t,e){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if("string"==typeof t||n)return function(t,e){if(e.text&&"string"==typeof t)return t;if(t instanceof ArrayBuffer){const n=t;if(e.text&&!e.binary){return new TextDecoder("utf8").decode(n)}return n}if(ArrayBuffer.isView(t)||(n=t)&&"object"==typeof n&&n.isBuffer){if(e.text&&!e.binary){return new TextDecoder("utf8").decode(t)}let n=t.buffer;const r=t.byteLength||t.length;return 0===t.byteOffset&&r===n.byteLength||(n=n.slice(t.byteOffset,t.byteOffset+r)),n}var n;throw new Error(Tr)}(t,e);if(Fn(t)&&(t=await er(t)),Un(t)){const n=t;return await nr(n),e.binary?await n.arrayBuffer():await n.text()}if(Bn(t)&&(t=kr(t)),jn(t)||zn(t))return gr(t);throw new Error(Tr)}const Mr=new Map;function Er(t,e=!0,n){const r=n||new Set;if(t){if(xr(t))r.add(t);else if(xr(t.buffer))r.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(const n in t)Er(t[n],e,r)}else;return void 0===n?Array.from(r):[]}function xr(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}let Rr=0;function Or({data:t,resolve:e}){e(t)}class Ar{constructor({source:t,name:e="web-worker-"+Rr++,onMessage:n}){const r=function(t,e="Worker"){if(Zt("string"==typeof t,"worker source"),t.startsWith("url(")&&t.endsWith(")")){const e=t.match(/^url\((.*)\)$/)[1];if(e&&!e.startsWith("http"))return e;t=function(t){return`try {\n  importScripts('${t}');\n} catch (error) {\n  console.error(error);\n}`}(e)}let n=Mr.get(t);if(!n){const e=new Blob([t],{type:"application/javascript"});n=URL.createObjectURL(e),Mr.set(t,n)}return n}(t,e);this.worker=new Worker(r,{name:e}),this.name=e,this.onMessage=n||Or}async process(t){return new Promise((e,n)=>{this.worker.onmessage=t=>{this.onMessage({worker:this.worker,data:t.data,resolve:e,reject:n})},this.worker.onerror=t=>{let e=this.name+": WorkerThread.process() failed";t.message&&(e+=` ${t.message} ${t.filename}:${t.lineno}:${t.colno}`);const r=new Error(e);console.error(t),n(r)};const r=Er(t);this.worker.postMessage(t,r)})}destroy(){this.worker.terminate(),this.worker=null}}class Cr{constructor({source:t,name:e="unnamed",maxConcurrency:n=1,onMessage:r,onDebug:i=(()=>{})}){this.source=t,this.name=e,this.maxConcurrency=n,this.onMessage=r,this.onDebug=i,this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}process(t,e){return new Promise((n,r)=>{this.jobQueue.push({data:t,jobName:e,resolve:n,reject:r}),this._startQueuedJob()})}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();this.onDebug({message:"processing",worker:t.name,job:e.jobName,backlog:this.jobQueue.length});try{e.resolve(await t.process(e.data))}catch(t){e.reject(t)}finally{this._onWorkerDone(t)}}_onWorkerDone(t){this.isDestroyed?t.destroy():(this.idleQueue.push(t),this._startQueuedJob())}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift();if(this.count<this.maxConcurrency){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Ar({source:this.source,onMessage:this.onMessage,name:t})}return null}}class Nr{static isSupported(){return"undefined"!=typeof Worker}constructor({maxConcurrency:t=5,onMessage:e=null,onDebug:n=(()=>{})}){this.maxConcurrency=t,this.onMessage=e,this.onDebug=n,this.workerPools=new Map}setProps(t){"maxConcurrency"in t&&(this.maxConcurrency=t.maxConcurrency),"onDebug"in t&&(this.onDebug=t.onDebug)}destroy(){this.workerPools.forEach(t=>t.destroy())}async process(t,e,n){return this._getWorkerPool(t,e).process(n)}_getWorkerPool(t,e){let n=this.workerPools.get(e);return n||(n=new Cr({source:t,name:e,onMessage:Pr.bind(null,this.onMessage),maxConcurrency:this.maxConcurrency,onDebug:this.onDebug}),this.workerPools.set(e,n)),n}}function Pr(t,{worker:e,data:n,resolve:r,reject:i}){if(t)t({worker:e,data:n,resolve:r,reject:i});else switch(n.type){case"done":r(n.result);break;case"error":i(n.message)}}function Dr(t,e,n,r){const{worker:i}=n||{},s=n&&n[t.id]||{},o=`url(${"local"===i?s.localWorkerUrl:s.workerUrl})`,a=t.name,u=function(t={}){const e={};t.maxConcurrency&&(e.maxConcurrency=t.maxConcurrency);t.onDebug&&(e.onDebug=t.onDebug);Ir||(Ir=new Nr({onMessage:qr}));return Ir.setProps(e),Ir}(n);n=JSON.parse(JSON.stringify(n));const c="2.3.1"!==t.version?"(core version 2.3.1)":"";return u.process(o,`${a}-worker@${t.version}${c}`,{arraybuffer:vr(e),options:n,source:"loaders.gl@2.3.1",type:"parse"})}let Ir=null;async function qr({worker:t,data:e,resolve:n,reject:r}){switch(e.type){case"done":n(e.result);break;case"parse":try{const n=await Wr(e.arraybuffer,e.options,e.url);t.postMessage({type:"parse-done",id:e.id,result:n},Er(n))}catch(n){t.postMessage({type:"parse-error",id:e.id,message:n.message})}break;case"error":r(e.message)}}const Lr=()=>{const t=ar();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};const Vr=/\.([^.]+)$/;function jr(t,e=[],n={},r={}){if(e&&!Array.isArray(e))return $n(e);!function(t){for(const e of t)$n(e)}(e=[...e||[],...Lr()]);const{url:i,type:s}=Jn(t);let o=function(t,e){const n=e&&e.match(Vr),r=n&&n[1];return r&&function(t,e){e=e.toLowerCase();for(const n of t)for(const t of n.extensions)if(t.toLowerCase()===e)return n;return null}(t,r)}(e,i||r.url);if(o=o||function(t,e){for(const n of t){if(n.mimeTypes&&n.mimeTypes.includes(e))return n;if(e==="application/x."+n.id)return n}return null}(e,s),o=o||function(t,e){if(!e)return null;for(const n of t)if("string"==typeof e){if(Ur(e,n))return n}else if(ArrayBuffer.isView(e)){if(Fr(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer){if(Fr(e,0,n))return n}return null}(e,t),!o&&!n.nothrow)throw new Error(zr(t));return o}function zr(t){const{url:e,type:n}=Jn(t);let r="No valid loader found";return t&&(r+=` data: "${function(t,e=5){if("string"==typeof t)return t.slice(0,e);if(ArrayBuffer.isView(t))return Br(t.buffer,t.byteOffset,e);if(t instanceof ArrayBuffer){return Br(t,0,e)}return""}(t)}", contentType: "${n}"`),e&&(r+=" url: "+e),r}function Ur(t,e){return e.testText&&e.testText(t)}function Fr(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>function(t,e,n,r){if(r instanceof ArrayBuffer)return function(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let t=0;t<r.length;++t)if(r[t]!==i[t])return!1;return!0}(r,t,r.byteLength);switch(typeof r){case"function":return r(t,n);case"string":const i=Br(t,e,r.length);return r===i;default:return!1}}(t,e,n,r))}function Br(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let t=0;t<n;t++)i+=String.fromCharCode(r.getUint8(e+t));return i}async function Wr(t,e,n,r){Zt(!r||"string"!=typeof r,"parse no longer accepts final url"),!e||Array.isArray(e)||Wn(e)||(r=n,n=e,e=null),t=await t,n=n||{};const{url:i}=Jn(t),s=function(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const t=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...t]:t}return n&&n.length?n:null}(e,r),o=await async function(t,e=[],n={},r={}){let i=jr(t,e,{...n,nothrow:!0},r);if(i)return i;if(Fn(t)&&(i=jr(t=await wr(t,0,10),e,n,r)),!i&&!n.nothrow)throw new Error(zr(t));return i}(t,s,n);return o?(r=function(t,e,n=null){return n||(t={fetch:hr(e||{},t),...t},Array.isArray(t.loaders)||(t.loaders=null),t)}({url:i,parse:Wr,loaders:s},n=cr(n,o,s,i),r),await async function(t,e,n,r){if(function(t,e="2.3.1"){Zt(t,"no loader provided");let n=t.version;e&&n&&(e=pr(e),n=pr(n))}(t),e=await Sr(e,t),t.parseTextSync&&"string"==typeof e)return n.dataType="text",t.parseTextSync(e,n,r,t);if(function(t,e,n,r){if(!Nr.isSupported())return!1;const i=n&&n[t.id];return!!("local"===n.worker&&i&&i.localWorkerUrl||n.worker&&i&&i.workerUrl)&&(!t.useWorker||t.useWorker(n))}(t,0,n))return await Dr(t,e,n);if(t.parseText&&"string"==typeof e)return await t.parseText(e,n,r,t);if(t.parse)return await t.parse(e,n,r,t);return Zt(!t.parseSync),Zt(!1)}(o,t,n,r)):null}async function $r(t,e,n){Array.isArray(e)||Wn(e)||(n=e,e=null);const r=hr(n||{});let i=t;return"string"==typeof t?i=await r(t):t=null,Fn(t)&&(i=await r(t),t=null),await Wr(i,e,n)}const Gr={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},Qr={ADD:1,REPLACE:2},Kr={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Yr={I3S:"I3S",TILES3D:"TILES3D"},Zr={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},Xr=1;function Hr(t){return null!=t}const Jr=new gt,ti=new gt,ei=new gt;new ft;function ni(t,e,n){if(Zt(t,"3D Tile: boundingVolume must be defined"),t.box)return function(t,e,n){const r=new gt(t[0],t[1],t[2]);e.transform(r,r);const i=e.transformAsVector(t.slice(3,6)),s=e.transformAsVector(t.slice(6,9)),o=e.transformAsVector(t.slice(9,12)),a=new ge([i[0],i[1],i[2],s[0],s[1],s[2],o[0],o[1],o[2]]);if(Hr(n))return n.center=r,n.halfAxes=a,n;return new an(r,a)}(t.box,e,n);if(t.region){const[e,n,r,i,s,o]=t.region,a=Gt.WGS84.cartographicToCartesian([R(e),R(i),s],ti),u=Gt.WGS84.cartographicToCartesian([R(r),R(n),o],ei),c=(new gt).addVectors(a,u).multiplyScalar(.5),h=(new gt).subVectors(a,u).len()/2;return ri([c[0],c[1],c[2],h],new ft)}if(t.sphere)return ri(t.sphere,e,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function ri(t,e,n){const r=new gt(t[0],t[1],t[2]);e.transform(r,r);const i=e.getScale(Jr),s=Math.max(Math.max(i[0],i[1]),i[2]),o=t[3]*s;return Hr(n)?(n.center=r,n.radius=o,n):new he(r,o)}new gt,new gt,new ft,new gt,new gt,new gt;function ii(t,e){if(t.dynamicScreenSpaceError&&t._dynamicScreenSpaceErrorComputedDensity){const n=t._dynamicScreenSpaceErrorComputedDensity,r=t.dynamicScreenSpaceErrorFactor;return function(t,e){const n=t*e;return 1-Math.exp(-n*n)}(e,n)*r}return 0}const si=Math.PI/2;function oi([t,e,n]){const r=E(t),i=E(e),s=1+n/6378137,o=s*Math.cos(i);return[t=o*Math.cos(r),e=o*Math.sin(r),n=s*Math.sin(i)]}function ai([t,e,n=0],[r,i,s=0]){const o=oi([r,i,s]),a=oi([t,e,n]),u=a[0]-o[0],c=a[1]-o[1],h=a[2]-o[2];return u*u+c*c+h*h}function ui(t,e){const n=e.viewport,r=t.header.mbs[1],i=[t.header.mbs[0],r,t.header.mbs[2]],s=t.header.mbs[3]/6378137,o=ai(n.unprojectPosition(n.cameraPosition),i)-s*s;if(o<=0)return 170141175e30;let a=function(t,e){const{width:n,height:r,pixelProjectionMatrix:i}=e.viewport,s=Math.tan(Math.atan(Math.sqrt(1/(i[0]*i[0])+1/(i[5]*i[5]))));return Math.sqrt(r*r+n*n)/s}(0,e);return a*=s/Math.sqrt(o)/n.scale,a}const ci=new gt;class hi{constructor(t,e,n){Zt("object"==typeof e),this.header=e,this.tileset=t,this.id=e.id,this.url=e.url,this.parent=n,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this.lodMetricType=null,this.lodMetricValue=null,this.boundingVolume=null,this.content=null,this.contentState=Gr.UNLOADED,this.gpuMemoryUsageInBytes=0,this.children=[],this.depth=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,this._getPriority=this._getPriority.bind(this),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Gr.READY||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Gr.UNLOADED}get contentExpired(){return this.contentState===Gr.EXPIRED}get contentFailed(){return this.contentState===Gr.FAILED}getScreenSpaceError(t,e){switch(this.tileset.type){case Yr.I3S:return ui(this,t);case Yr.TILES3D:return function(t,e,n){const r=t.tileset,i=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,s=n?i:t.lodMetricValue;if(0===s)return 0;const o=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:u}=e;let c=s*a/(o*u);return c-=ii(r,o),c}(this,t,e);default:return console.error("Unsupported tileset type"),null}}_getPriority(){return this.isVisible?this.contentState===Gr.UNLOADED?-1:Math.max(1e7-this._priority,0)||0:-1}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Gr.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority);if(!t)return this.contentState=Gr.UNLOADED,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.fetchOptions,i=this.tileset.loader,s={...n,[i.id]:{tile:this.header,tileset:this.tileset.tileset,isTileset:"auto",isTileHeader:!1,assetGltfUpAxis:this.tileset.asset.gltfUpAxis}};return this.content=await $r(e,i,s),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this,r.dirname(this.contentUrl)),this.contentState=Gr.READY,this._onContentLoaded(),!0}catch(t){throw this.contentState=Gr.FAILED,t}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.contentState=Gr.UNLOADED,!0}updateVisibility(t){if(this._frameNumber===t.frameNumber)return;const e=this.parent,n=e?e.computedTransform:this.tileset.modelMatrix,r=e?e._visibilityPlaneMask:mn.MASK_INDETERMINATE;this._updateTransform(n),this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,r),this._visible=this._visibilityPlaneMask!==mn.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._priority=this.lodMetricValue,this._frameNumber=t.frameNumber}visibility(t,e){const{cullingVolume:n}=t,{boundingVolume:r}=this;return n.computeVisibilityWithPlaneMask(r,e)}contentVisibility(t){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth({camera:t}){const e=this.boundingVolume;return ci.subVectors(e.center,t.position),t.direction.dot(ci)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||0===e.distanceToCamera(t)}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new ft(t.transform):new ft;const e=this.parent,n=this.tileset,r=e&&e.computedTransform?e.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new ft(r).multiplyRight(this.transform);const i=e&&e._initialTransform?e._initialTransform.clone():new ft;this._initialTransform=new ft(i).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Gr.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level,this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=mn.MASK_INDETERMINATE,this._visible=!1,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||Qr.REPLACE}_isTileset(){return-1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset.traverser.disableSkipLevelOfDetail=!0}this._isTileset()&&(this.hasTilesetContent=!0)}_updateBoundingVolume(t){this.boundingVolume=ni(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=ni(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=ni(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(t=new ft){const e=t.clone().multiplyRight(this.transform);!e.equals(this.computedTransform)&&(this.computedTransform=e,this._updateBoundingVolume(this.header))}updateExpiration(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=Gr.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}}class li{constructor(t=0){this._array=new Array(t),this._map=new Map,this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return Zt(t<this._array.length),this._array[t]}set(t,e){Zt(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){Zt(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){Zt(t>=0),this.length=t}trim(t){null==t&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const fi={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2};class di{constructor(t){this.options={...fi,...t},this._traversalStack=new li,this._emptyTraversalStack=new li,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}traverse(t,e,n){this.root=t,this.options={...this.options,...n},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const n=this._traversalStack;for(n.push(t);n.length>0;){const t=n.pop();let r=!1;this.canTraverse(t,e)&&(this.updateChildTiles(t,e),r=this.updateAndPushChildren(t,e,n));const i=t.parent,s=Boolean(!i||i._shouldRefine),o=!r;t.hasRenderContent?t.refine===Qr.ADD?(this.loadTile(t,e),this.selectTile(t,e)):t.refine===Qr.REPLACE&&(this.loadTile(t,e),o&&this.selectTile(t,e)):(this.emptyTiles[t.id]=t,this.loadTile(t,e),o&&this.selectTile(t,e)),this.touchTile(t,e),t._shouldRefine=r&&s}this.options.onTraversalEnd&&this.options.onTraversalEnd(e)}updateChildTiles(t,e){const n=t.children;for(const t of n)this.updateTile(t,e);return!0}updateAndPushChildren(t,e,n){const{loadSiblings:r,skipLevelOfDetail:i}=this.options,s=t.children;s.sort(this.compareDistanceToCamera);const o=!i&&t.refine===Qr.REPLACE&&t.hasRenderContent;let a=!1;for(const t of s)if(t.isVisibleAndInRequestVolume?(n.find(t)&&n.delete(t),n.push(t),a=!0):(o||r)&&(this.loadTile(t,e),this.touchTile(t,e)),o){let n;if(n=!!t._inRequestVolume&&(t.hasRenderContent?t.contentAvailable:this.executeEmptyTraversal(t,e)),!n)return n}return a}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t,e)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t,e)&&(t._requestedFrame=e.frameNumber,t._priority=this.getPriority(t),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e,n=!1,r=!1){return!(!r&&!t.isVisibleAndInRequestVolume)&&(!!t.hasChildren&&(t.hasTilesetContent?!t.contentExpired:this.shouldRefine(t,e,n)))}shouldLoadTile(t,e){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t,e){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e,n){let r=t._screenSpaceError;return n&&(r=t.getScreenSpaceError(e,!0)),r>this.options.maximumScreenSpaceError}updateTileVisibility(t,e){t.updateVisibility(e)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}getPriority(t){const{options:e}=this;switch(t.refine){case Qr.ADD:return t._distanceToCamera;case Qr.REPLACE:const{parent:n}=t,r=n&&(!e.skipLevelOfDetail||0===t._screenSpaceError||n.hasTilesetContent)?n._screenSpaceError:t._screenSpaceError;return this.root._screenSpaceError-r;default:return Zt(!1)}}anyChildrenVisible(t,e){let n=!1;for(const r of t.children)r.updateVisibility(e),n=n||r.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(t,e){let n=!0;const r=this._emptyTraversalStack;for(;r.length>0;){const t=r.pop();this.updateTile(t,e),t.isVisibleAndInRequestVolume||(this.loadTile(t,e),this.touchTile(t,e));const i=!t.hasRenderContent&&this.canTraverse(t,e,!1,!0);if(i||t.contentAvailable||(n=!1),i){const e=t.children.filter(t=>t);for(const t of e)r.find(t)&&r.delete(t),r.push(t)}}return n}}class yi extends di{compareDistanceToCamera(t,e){return 0===e._distanceToCamera&&0===t._distanceToCamera?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(t.updateVisibility(e),!t.isVisibleAndInRequestVolume)return;const n=t.children.length>0;if(t.hasTilesetContent&&n){const n=t.children[0];return this.updateTileVisibility(n,e),void(t._visible=n._visible)}if(this.meetsScreenSpaceErrorEarly(t,e))return void(t._visible=!1);const r=t.refine===Qr.REPLACE,i=t._optimChildrenWithinParent===Xr;r&&i&&n&&!this.anyChildrenVisible(t,e)&&(t._visible=!1)}meetsScreenSpaceErrorEarly(t,e){const{parent:n}=t;return!(!n||n.hasTilesetContent||n.refine!==Qr.ADD)&&!this.shouldRefine(t,e,!0)}}const pi="REQUESTED",mi="COMPLETED",vi="ERROR";class gi{constructor(){this._statusMap={}}add(t,e,n,r){this._statusMap[e]||(this._statusMap[e]={request:t,callback:n,key:e,frameState:r,status:pi},t().then(t=>{this._statusMap[e].status=mi,this._statusMap[e].callback(t,r)}).catch(t=>{this._statusMap[e].status=vi,n(t)}))}update(t,e){this._statusMap[t]&&(this._statusMap[t].frameState=e)}find(t){return this._statusMap[t]}}class wi extends di{constructor(t){super(t),this._tileManager=new gi}shouldRefine(t,e){return t._lodJudge=function(t,e){const n=e.viewport,r=n.metersPerPixel,i=t.header.mbs[1],s=t.header.mbs[0],o=t.header.mbs[2],a=t.header.mbs[3],{height:u,width:c,latitude:h,longitude:l}=n,f=[l,h],d=[s,i,o],y=[l,i],p=[s,h],m=Math.sqrt(u*u+c*c)*r[0],v=.5*u+a/6378137,g=.5*c+a/6378137;if(ai(f,d)>m+a/6378137)return"OUT";if(ai(f,y)>v)return"OUT";if(ai(f,p)>g)return"OUT";if(0===t.lodMetricValue)return"DIG";let w=ui(t,e);return w*=si,w<.5?"OUT":!t.header.children||w<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}(t,e),"DIG"===t._lodJudge}updateChildTiles(t,e){const n=t.header.children||[],r=t.children,i=t.tileset;for(const s of n){const n=r&&r.find(t=>t.id===s.id);if(n)n&&this.updateTile(n,e);else{let n=()=>this._loadTile(s.id,i);this._tileManager.find(s.id)?this._tileManager.update(s.id,e):(i.tileset.nodePages&&(n=()=>i.tileset.nodePagesTile.formTileFromNodePages(s.id)),this._tileManager.add(n,s.id,e=>this._onTileLoad(e,t),e))}}}async _loadTile(t,e){const{loader:n}=e,r=e.getTileUrl(`${e.url}/nodes/${t}`),i={i3s:{...e.fetchOptions,isTileHeader:!0,loadContent:!1}};return await $r(r,n,i)}_onTileLoad(t,e){const n=this.options.basePath,r=new hi(e.tileset,t,e,n);e.children.push(r);const i=this._tileManager.find(r.id).frameState;this.updateTile(r,i),this._frameNumber===i.frameNumber&&this.executeTraversal(r,i)}}const bi={ellipsoid:Gt.WGS84,modelMatrix:new ft,throttleRequests:!1,maximumMemoryUsage:32,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:(t,e,n)=>{},maximumScreenSpaceError:8};class _i{constructor(t,e={}){Zt(t),this.options={...bi,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||r.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.fetchOptions=this.options.fetchOptions||{},this.options.headers&&(this.fetchOptions.headers=this.options.headers),this.options.token&&(this.fetchOptions.token=this.options.token),this.root=null,this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this._traverser=this._initializeTraverser(),this._cache=new re,this._requestScheduler=new Jt({throttleRequests:this.options.throttleRequests}),this._frameNumber=0,this._updateFrameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this._queryParams={},this._queryParamsString=null,this.maximumMemoryUsage=this.options.maximumMemoryUsage,this.gpuMemoryUsageInBytes=0,this.stats=new Yt({id:this.url}),this._initializeStats(),this._hasMixedContent=!1,this._maximumScreenSpaceError=this.options.maximumScreenSpaceError,this._properties=void 0,this._extensionsUsed=void 0,this._gltfUpAxis=void 0,this._dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description,this._defaultGeometrySchema=[],this._initializeTileSet(t,this.options)}isLoaded(){return 0===this._pendingCount}destroy(){this._destroy()}get tiles(){return Object.values(this._tiles)}getTileUrl(t){return t.startsWith("data:")?t:`${t}${this.queryParams}`}update(t){this._cache.reset(),this._frameNumber++,this._frameState=Pn(t,this._frameNumber),this._traverser.traverse(this.root,this._frameState,this.options)}_onTraversalEnd(){const t=Object.values(this._traverser.selectedTiles);this._tilesChanged(this.selectedTiles,t)&&this._updateFrameNumber++,this.selectedTiles=t;for(const t of this.selectedTiles)this._tiles[t.id]=t;return this._requestedTiles=Object.values(this._traverser.requestedTiles),this._emptyTiles=Object.values(this._traverser.emptyTiles),this._loadTiles(this._frameState),this._unloadTiles(),this._updateStats(),this._updateFrameNumber}_tilesChanged(t,e){if(t.length!==e.length)return!0;const n=new Set(t.map(t=>t.id)),r=new Set(e.map(t=>t.id));let i=t.filter(t=>!r.has(t.id)).length>0;return i=i||e.filter(t=>!n.has(t.id)).length>0,i}_loadTiles(t){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e,t)}_unloadTiles(){this._cache.unloadTiles(this,(t,e)=>t._unloadTile(e))}_updateStats(){let t=0,e=0;for(const n of this.selectedTiles)n.contentAvailable&&(t++,n.content.pointCount&&(e+=n.content.pointCount));this.stats.get("Tiles In View").count=this.selectedTiles.length,this.stats.get("Tiles To Render").count=t,this.stats.get("Points").count=e}_initializeTileSet(t){this.root=this._initializeTileHeaders(t,null,this.basePath),this.type===Yr.TILES3D&&this._initializeCesiumTileset(t),this.type===Yr.I3S&&this._initializeI3STileset(t),this._calculateViewProps()}_calculateViewProps(){const t=this.root,{center:e}=t.boundingVolume;if(!e)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new gt,void(this.zoom=1);this.cartographicCenter=Gt.WGS84.cartesianToCartographic(e,new gt),this.cartesianCenter=e,this.zoom=function(t){const{halfAxes:e,radius:n,width:r,height:i}=t;if(e){e.getColumn(0,Dn);const t=Dn.len();e.getColumn(1,Dn);const n=Dn.len();e.getColumn(2,Dn);const r=t/2,i=n/2,s=Dn.len()/2;return(Math.log2(6378137/r)+Math.log2(6378137/i)+Math.log2(6356752.314245179/s))/3}if(n)return Math.log2(6356752.314245179/n);if(i&&r){return(Math.log2(6378137/r)+Math.log2(6378137/i))/2}return 1}(t.boundingVolume)}_initializeStats(){this.stats.get("Tiles In Tileset(s)"),this.stats.get("Tiles Loading"),this.stats.get("Tiles In Memory"),this.stats.get("Tiles In View"),this.stats.get("Tiles To Render"),this.stats.get("Tiles Loaded"),this.stats.get("Tiles Unloaded"),this.stats.get("Failed Tile Loads"),this.stats.get("Points","memory"),this.stats.get("Tile Memory Use","memory")}_initializeTileHeaders(t,e,n){const r=new hi(this,t.root,e,n);if(e&&(e.children.push(r),r.depth=e.depth+1),this.type===Yr.TILES3D){const t=[];for(t.push(r);t.length>0;){const e=t.pop();this.stats.get("Tiles In Tileset(s)").incrementCount();const r=e.header.children||[];for(const i of r){const r=new hi(this,i,e,n);e.children.push(r),r.depth=e.depth+1,t.push(r)}}}return r}_initializeTraverser(){let t;switch(this.type){case Yr.TILES3D:t=yi;break;case Yr.I3S:t=wi;break;default:t=di}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t,e){let n;try{this._onStartTileLoading(),n=await t.loadContent(e)}catch(e){this._onTileLoadError(t,e)}finally{this._onEndTileLoading(),this._onTileLoad(t,n)}}_onTileLoadError(t,e){this.stats.get("Failed Tile Loads").incrementCount();const n=e.message||e.toString(),r=t.url;console.error(`A 3D tile failed to load: ${t.url} ${n}`),this.options.onTileError(t,n,r)}_onTileLoad(t,e){e&&(t&&t.content&&ie(t,t.content),this._addTileToCache(t),this.options.onTileLoad(t))}_onStartTileLoading(){this._pendingCount++,this.stats.get("Tiles Loading").incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get("Tiles Loading").decrementCount()}_addTileToCache(t){this._cache.add(this,t,e=>e._updateCacheStats(t))}_updateCacheStats(t){this.stats.get("Tiles Loaded").incrementCount(),this.stats.get("Tiles In Memory").incrementCount(),this.gpuMemoryUsageInBytes+=t.content.byteLength||0,this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.content.byteLength||0,this.stats.get("Tiles In Memory").decrementCount(),this.stats.get("Tiles Unloaded").incrementCount(),this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const n of e.children)t.push(n);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,n=[];for(n.push(e);n.length>0;){t=n.pop();for(const e of t.children)n.push(e);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeCesiumTileset(t){if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description,this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed,this.extras=t.extras}_initializeI3STileset(t){"token"in this.options&&(this._queryParams.token=this.options.token),this._defaultGeometrySchema=t.store.defaultGeometrySchema}hasExtension(t){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(t)>-1)}get queryParams(){return this._queryParamsString||(this._queryParamsString=function(t){const e=[];for(const n of Object.keys(t))e.push(`${n}=${t[n]}`);switch(e.length){case 0:return"";case 1:return"?"+e[0];default:return"?"+e.join("&")}}(this._queryParams)),this._queryParamsString}}}])}));