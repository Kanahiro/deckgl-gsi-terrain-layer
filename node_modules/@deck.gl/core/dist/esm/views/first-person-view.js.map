{"version":3,"sources":["../../../src/views/first-person-view.js"],"names":["View","Viewport","getMeterZoom","Matrix4","_SphericalCoordinates","SphericalCoordinates","FirstPersonController","getDirectionFromBearingAndPitch","bearing","pitch","spherical","direction","toVector3","normalize","FirstPersonView","props","modelMatrix","up","dir","center","transformDirection","zoom","scale","Math","pow","viewMatrix","lookAt","eye","Object","assign","_getControllerProps","type","displayName"],"mappings":";;;;;;;;;;AAAA,OAAOA,IAAP,MAAiB,QAAjB;AACA,OAAOC,QAAP,MAAqB,uBAArB;AACA,SAAQC,YAAR,QAA2B,uBAA3B;AACA,SAAQC,OAAR,EAAiBC,qBAAqB,IAAIC,oBAA1C,QAAqE,SAArE;AACA,OAAOC,qBAAP,MAAkC,wCAAlC;;AAEA,SAASC,+BAAT,OAA2D;AAAA,MAAjBC,OAAiB,QAAjBA,OAAiB;AAAA,MAARC,KAAQ,QAARA,KAAQ;AACzD,MAAMC,SAAS,GAAG,IAAIL,oBAAJ,CAAyB;AAACG,IAAAA,OAAO,EAAPA,OAAD;AAAUC,IAAAA,KAAK,EAALA;AAAV,GAAzB,CAAlB;AACA,MAAME,SAAS,GAAGD,SAAS,CAACE,SAAV,GAAsBC,SAAtB,EAAlB;AACA,SAAOF,SAAP;AACD;;IAEoBG,e;;;;;;;;;;;;;iCAONC,K,EAAO;AAAA,+BAQdA,KARc,CAIhBC,WAJgB;AAAA,UAIhBA,WAJgB,mCAIF,IAJE;AAAA,2BAQdD,KARc,CAKhBP,OALgB;AAAA,UAKhBA,OALgB,+BAKN,CALM;AAAA,yBAQdO,KARc,CAMhBN,KANgB;AAAA,UAMhBA,KANgB,6BAMR,CANQ;AAAA,sBAQdM,KARc,CAOhBE,EAPgB;AAAA,UAOhBA,EAPgB,0BAOX,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAPW;AAWlB,UAAMC,GAAG,GAAGX,+BAA+B,CAAC;AAC1CC,QAAAA,OAAO,EAAPA,OAD0C;AAE1CC,QAAAA,KAAK,EAAE,KAAKA;AAF8B,OAAD,CAA3C;AAMA,UAAMU,MAAM,GAAGH,WAAW,GAAGA,WAAW,CAACI,kBAAZ,CAA+BF,GAA/B,CAAH,GAAyCA,GAAnE;AAGA,UAAMG,IAAI,GAAGnB,YAAY,CAACa,KAAD,CAAzB;AACA,UAAMO,KAAK,GAAGC,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYH,IAAZ,CAAd;AACA,UAAMI,UAAU,GAAG,IAAItB,OAAJ,GAAcuB,MAAd,CAAqB;AAACC,QAAAA,GAAG,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAN;AAAiBR,QAAAA,MAAM,EAANA,MAAjB;AAAyBF,QAAAA,EAAE,EAAFA;AAAzB,OAArB,EAAmDK,KAAnD,CAAyDA,KAAzD,CAAnB;AAEA,aAAO,IAAIrB,QAAJ,CACL2B,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBd,KAAlB,EAAyB;AACvBM,QAAAA,IAAI,EAAJA,IADuB;AAEvBI,QAAAA,UAAU,EAAVA;AAFuB,OAAzB,CADK,CAAP;AAMD;;;wBApCgB;AACf,aAAO,KAAKK,mBAAL,CAAyB;AAC9BC,QAAAA,IAAI,EAAEzB;AADwB,OAAzB,CAAP;AAGD;;;;EAL0CN,I;;SAAxBc,e;AAwCrBA,eAAe,CAACkB,WAAhB,GAA8B,iBAA9B","sourcesContent":["import View from './view';\nimport Viewport from '../viewports/viewport';\nimport {getMeterZoom} from '@math.gl/web-mercator';\nimport {Matrix4, _SphericalCoordinates as SphericalCoordinates} from 'math.gl';\nimport FirstPersonController from '../controllers/first-person-controller';\n\nfunction getDirectionFromBearingAndPitch({bearing, pitch}) {\n  const spherical = new SphericalCoordinates({bearing, pitch});\n  const direction = spherical.toVector3().normalize();\n  return direction;\n}\n\nexport default class FirstPersonView extends View {\n  get controller() {\n    return this._getControllerProps({\n      type: FirstPersonController\n    });\n  }\n\n  _getViewport(props) {\n    // TODO - push direction handling into Matrix4.lookAt\n    const {\n      // view matrix arguments\n      modelMatrix = null,\n      bearing = 0,\n      pitch = 0,\n      up = [0, 0, 1] // Defines up direction, default positive z axis,\n    } = props;\n\n    // Always calculate direction from bearing and pitch\n    const dir = getDirectionFromBearingAndPitch({\n      bearing,\n      pitch: 90 + pitch\n    });\n\n    // Direction is relative to model coordinates, of course\n    const center = modelMatrix ? modelMatrix.transformDirection(dir) : dir;\n\n    // Just the direction. All the positioning is done in viewport.js\n    const zoom = getMeterZoom(props);\n    const scale = Math.pow(2, zoom);\n    const viewMatrix = new Matrix4().lookAt({eye: [0, 0, 0], center, up}).scale(scale);\n\n    return new Viewport(\n      Object.assign({}, props, {\n        zoom,\n        viewMatrix\n      })\n    );\n  }\n}\n\nFirstPersonView.displayName = 'FirstPersonView';\n"],"file":"first-person-view.js"}