{"version":3,"sources":["../../src/normalize-viewport-props.js"],"names":["WebMercatorViewport","mod","MAX_LATITUDE","MIN_LATITUDE","normalizeViewportProps","width","height","longitude","latitude","zoom","pitch","bearing","flatViewport","topY","project","bottomY","shiftY","Math","log2","unproject"],"mappings":"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","sourcesContent":["import WebMercatorViewport from './web-mercator-viewport';\nimport {mod} from './math-utils';\n\n// defined by mapbox-gl\nconst MAX_LATITUDE = 85.05113;\nconst MIN_LATITUDE = -85.05113;\n\n// Apply mathematical constraints to viewport props\n// eslint-disable-next-line complexity\nexport default function normalizeViewportProps({\n  width,\n  height,\n  longitude,\n  latitude,\n  zoom,\n  pitch = 0,\n  bearing = 0\n}) {\n  // Normalize degrees\n  if (longitude < -180 || longitude > 180) {\n    longitude = mod(longitude + 180, 360) - 180;\n  }\n  if (bearing < -180 || bearing > 180) {\n    bearing = mod(bearing + 180, 360) - 180;\n  }\n\n  // Constrain zoom and shift center at low zoom levels\n  let flatViewport = new WebMercatorViewport({width, height, longitude, latitude, zoom});\n  let topY = flatViewport.project([longitude, MAX_LATITUDE])[1];\n  let bottomY = flatViewport.project([longitude, MIN_LATITUDE])[1];\n  let shiftY = 0;\n\n  if (bottomY - topY < height) {\n    // Map height must not be smaller than viewport height\n    // Zoom out map to fit map height into viewport\n    zoom += Math.log2(height / (bottomY - topY));\n\n    // Calculate top and bottom using new zoom\n    flatViewport = new WebMercatorViewport({width, height, longitude, latitude, zoom});\n    topY = flatViewport.project([longitude, MAX_LATITUDE])[1];\n    bottomY = flatViewport.project([longitude, MIN_LATITUDE])[1];\n  }\n  if (topY > 0) {\n    // Compensate for white gap on top\n    shiftY = topY;\n  } else if (bottomY < height) {\n    // Compensate for white gap on bottom\n    shiftY = bottomY - height;\n  }\n  if (shiftY) {\n    latitude = flatViewport.unproject([width / 2, height / 2 + shiftY])[1];\n  }\n\n  return {width, height, longitude, latitude, zoom, pitch, bearing};\n}\n"],"file":"normalize-viewport-props.js"}