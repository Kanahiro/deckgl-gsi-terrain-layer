{"version":3,"sources":["../../../src/lib/common.js"],"names":["assert","RADIANS_TO_DEGREES","Math","PI","DEGREES_TO_RADIANS","config","EPSILON","debug","precision","printTypes","printDegrees","printRowMajor","configure","options","key","round","value","formatValue","parseFloat","toPrecision","isArray","Array","ArrayBuffer","isView","DataView","duplicateArray","array","clone","length","map","func","result","i","toRadians","degrees","radians","toDegrees","sin","angle","cos","tan","asin","acos","atan","clamp","min","max","lerp","a","b","t","ai","equals","epsilon","oldEpsilon","Number","isFinite","abs","exactEquals","constructor","withEpsilon","oldPrecision"],"mappings":"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","sourcesContent":["// Copyright (c) 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport assert from './assert';\n\nconst RADIANS_TO_DEGREES = (1 / Math.PI) * 180;\nconst DEGREES_TO_RADIANS = (1 / 180) * Math.PI;\n\n// TODO - remove\n/* eslint-disable no-shadow */\nconst config = {};\nconfig.EPSILON = 1e-12;\nconfig.debug = false;\nconfig.precision = 4;\nconfig.printTypes = false;\nconfig.printDegrees = false;\nconfig.printRowMajor = true;\n\nexport {config};\n\nexport function configure(options = {}) {\n  // Only copy existing keys\n  for (const key in options) {\n    assert(key in config);\n    config[key] = options[key];\n  }\n  return config;\n}\n\nfunction round(value) {\n  return Math.round(value / config.EPSILON) * config.EPSILON;\n}\n\nexport function formatValue(value, {precision = config.precision || 4} = {}) {\n  value = round(value);\n  // get rid of trailing zeros\n  return `${parseFloat(value.toPrecision(precision))}`;\n}\n\n// Returns true if value is either an array or a typed array\n// Note: does not return true for ArrayBuffers and DataViews\nexport function isArray(value) {\n  return Array.isArray(value) || (ArrayBuffer.isView(value) && !(value instanceof DataView));\n}\n\n// If the array has a clone function, calls it, otherwise returns a copy\nfunction duplicateArray(array) {\n  return array.clone ? array.clone() : new Array(array.length);\n}\n\nexport function clone(array) {\n  return array.clone ? array.clone() : new Array(...array);\n}\n\n// If the argument value is an array, applies the func element wise,\n// otherwise applies func to the argument value\nfunction map(value, func, result) {\n  if (isArray(value)) {\n    result = result || duplicateArray(value);\n    for (let i = 0; i < result.length && i < value.length; ++i) {\n      result[i] = func(value[i], i, result);\n    }\n    return result;\n  }\n  return func(value);\n}\n\nexport function toRadians(degrees) {\n  return radians(degrees);\n}\n\nexport function toDegrees(radians) {\n  return degrees(radians);\n}\n\n//\n// GLSL math function equivalents\n// Works on both single values and vectors\n//\n\nexport function radians(degrees, result) {\n  return map(degrees, degrees => degrees * DEGREES_TO_RADIANS, result);\n}\n\nexport function degrees(radians, result) {\n  return map(radians, radians => radians * RADIANS_TO_DEGREES, result);\n}\n\n// GLSL equivalent: Works on single values and vectors\nexport function sin(radians) {\n  return map(radians, angle => Math.sin(angle));\n}\n\n// GLSL equivalent: Works on single values and vectors\nexport function cos(radians) {\n  return map(radians, angle => Math.cos(angle));\n}\n\n// GLSL equivalent: Works on single values and vectors\nexport function tan(radians) {\n  return map(radians, angle => Math.tan(angle));\n}\n\n// GLSL equivalent: Works on single values and vectors\nexport function asin(radians) {\n  return map(radians, angle => Math.asin(angle));\n}\n\n// GLSL equivalent: Works on single values and vectors\nexport function acos(radians) {\n  return map(radians, angle => Math.acos(angle));\n}\n\n// GLSL equivalent: Works on single values and vectors\nexport function atan(radians) {\n  return map(radians, angle => Math.atan(angle));\n}\n\nexport function clamp(value, min, max) {\n  return map(value, value => Math.max(min, Math.min(max, value)));\n}\n\n// Interpolate between two numbers or two arrays\nexport function lerp(a, b, t) {\n  if (isArray(a)) {\n    return a.map((ai, i) => lerp(ai, b[i], t));\n  }\n  return t * b + (1 - t) * a;\n}\n\n// eslint-disable-next-line complexity\nexport function equals(a, b, epsilon) {\n  const oldEpsilon = config.EPSILON;\n  if (epsilon) {\n    config.EPSILON = epsilon;\n  }\n  try {\n    if (a === b) {\n      return true;\n    }\n    if (isArray(a) && isArray(b)) {\n      if (a.length !== b.length) {\n        return false;\n      }\n      for (let i = 0; i < a.length; ++i) {\n        // eslint-disable-next-line max-depth\n        if (!equals(a[i], b[i])) {\n          return false;\n        }\n      }\n      return true;\n    }\n    if (a && a.equals) {\n      return a.equals(b);\n    }\n    if (b && b.equals) {\n      return b.equals(a);\n    }\n    if (Number.isFinite(a) && Number.isFinite(b)) {\n      return Math.abs(a - b) <= config.EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n    }\n    return false;\n  } finally {\n    config.EPSILON = oldEpsilon;\n  }\n}\n\n// eslint-disable-next-line complexity\nexport function exactEquals(a, b) {\n  if (a === b) {\n    return true;\n  }\n  if (a && typeof a === 'object' && b && typeof b === 'object') {\n    if (a.constructor !== b.constructor) {\n      return false;\n    }\n    if (a.exactEquals) {\n      return a.exactEquals(b);\n    }\n  }\n  if (isArray(a) && isArray(b)) {\n    if (a.length !== b.length) {\n      return false;\n    }\n    for (let i = 0; i < a.length; ++i) {\n      if (!exactEquals(a[i], b[i])) {\n        return false;\n      }\n    }\n    return true;\n  }\n  return false;\n}\n\nexport function withEpsilon(EPSILON, func) {\n  const oldPrecision = config.EPSILON;\n  config.EPSILON = EPSILON;\n  let value;\n  try {\n    value = func();\n  } finally {\n    config.EPSILON = oldPrecision;\n  }\n  return value;\n}\n"],"file":"common.js"}