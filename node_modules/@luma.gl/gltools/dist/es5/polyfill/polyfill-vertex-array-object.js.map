{"version":3,"sources":["../../../src/polyfill/polyfill-vertex-array-object.js"],"names":["glErrorShadow","error","msg","global","console","log","synthesizeGLError","err","opt_msg","undefined","wrapGLError","gl","f","getError","apply","parseInt","WebGLVertexArrayObjectOES","ext","isAlive","hasBeenBound","elementArrayBuffer","attribs","Array","maxVertexAttribs","n","length","attrib","VertexAttrib","maxAttrib","enabled","buffer","size","type","normalized","stride","offset","cached","recache","prototype","join","OESVertexArrayObject","self","original","getParameter","enableVertexAttribArray","disableVertexAttribArray","bindBuffer","getVertexAttrib","vertexAttribPointer","pname","VERTEX_ARRAY_BINDING_OES","currentVertexArrayObject","defaultVertexArrayObject","arguments","index","vao","Math","max","target","currentArrayBuffer","indx","instrumentExtension","canvas","addEventListener","reset_","contextWasLost","vertexArrayObjects","ii","bindVertexArrayOES","createVertexArrayOES","arrayObject","push","deleteVertexArrayOES","splice","indexOf","isVertexArrayOES","oldVAO","newVAO","call","currentBinding","oldAttrib","bufferChanged","polyfillVertexArrayObject","createVertexArray","original_getSupportedExtensions","getSupportedExtensions","list","original_getExtension","getExtension","name","__OESVertexArrayObject"],"mappings":"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","sourcesContent":["/*\n** Copyright (c) 2015 The Khronos Group Inc.\n**\n** Permission is hereby granted, free of charge, to any person obtaining a\n** copy of this software and/or associated documentation files (the\n** \"Materials\"), to deal in the Materials without restriction, including\n** without limitation the rights to use, copy, modify, merge, publish,\n** distribute, sublicense, and/or sell copies of the Materials, and to\n** permit persons to whom the Materials are furnished to do so, subject to\n** the following conditions:\n**\n** The above copyright notice and this permission notice shall be included\n** in all copies or substantial portions of the Materials.\n**\n** THE MATERIALS ARE PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n** EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n** MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n** IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n** CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n** TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n** MATERIALS OR THE USE OR OTHER DEALINGS IN THE MATERIALS.\n*/\n\n// Modified to use ES6 and polyfill a provided context rather than\n// the global class.\n\nimport {global} from 'probe.gl/env';\n\nconst glErrorShadow = {};\n\nfunction error(msg) {\n  if (global.console && global.console.error) {\n    global.console.error(msg);\n  }\n}\n\nfunction log(msg) {\n  if (global.console && global.console.log) {\n    global.console.log(msg);\n  }\n}\n\nfunction synthesizeGLError(err, opt_msg) {\n  glErrorShadow[err] = true;\n  if (opt_msg !== undefined) {\n    error(opt_msg);\n  }\n}\n\nfunction wrapGLError(gl) {\n  const f = gl.getError;\n  gl.getError = function getError() {\n    let err;\n    do {\n      err = f.apply(gl);\n      if (err !== gl.NO_ERROR) {\n        glErrorShadow[err] = true;\n      }\n    } while (err !== gl.NO_ERROR);\n\n    for (err in glErrorShadow) {\n      if (glErrorShadow[err]) {\n        delete glErrorShadow[err];\n        return parseInt(err, 10);\n      }\n    }\n\n    return gl.NO_ERROR;\n  };\n}\n\nconst WebGLVertexArrayObjectOES = function WebGLVertexArrayObjectOES(ext) {\n  const gl = ext.gl;\n\n  this.ext = ext;\n  this.isAlive = true;\n  this.hasBeenBound = false;\n\n  this.elementArrayBuffer = null;\n  this.attribs = new Array(ext.maxVertexAttribs);\n  for (let n = 0; n < this.attribs.length; n++) {\n    const attrib = new WebGLVertexArrayObjectOES.VertexAttrib(gl);\n    this.attribs[n] = attrib;\n  }\n\n  this.maxAttrib = 0;\n};\n\nWebGLVertexArrayObjectOES.VertexAttrib = function VertexAttrib(gl) {\n  this.enabled = false;\n  this.buffer = null;\n  this.size = 4;\n  this.type = gl.FLOAT;\n  this.normalized = false;\n  this.stride = 16;\n  this.offset = 0;\n\n  this.cached = '';\n  this.recache();\n};\nWebGLVertexArrayObjectOES.VertexAttrib.prototype.recache = function recache() {\n  this.cached = [this.size, this.type, this.normalized, this.stride, this.offset].join(':');\n};\n\nconst OESVertexArrayObject = function OESVertexArrayObject(gl) {\n  const self = this;\n  this.gl = gl;\n\n  wrapGLError(gl);\n\n  const original = (this.original = {\n    getParameter: gl.getParameter,\n    enableVertexAttribArray: gl.enableVertexAttribArray,\n    disableVertexAttribArray: gl.disableVertexAttribArray,\n    bindBuffer: gl.bindBuffer,\n    getVertexAttrib: gl.getVertexAttrib,\n    vertexAttribPointer: gl.vertexAttribPointer\n  });\n\n  gl.getParameter = function getParameter(pname) {\n    if (pname === self.VERTEX_ARRAY_BINDING_OES) {\n      if (self.currentVertexArrayObject === self.defaultVertexArrayObject) {\n        return null;\n      }\n      return self.currentVertexArrayObject;\n    }\n    return original.getParameter.apply(this, arguments);\n  };\n\n  gl.enableVertexAttribArray = function enableVertexAttribArray(index) {\n    const vao = self.currentVertexArrayObject;\n    vao.maxAttrib = Math.max(vao.maxAttrib, index);\n    const attrib = vao.attribs[index];\n    attrib.enabled = true;\n    return original.enableVertexAttribArray.apply(this, arguments);\n  };\n  gl.disableVertexAttribArray = function disableVertexAttribArray(index) {\n    const vao = self.currentVertexArrayObject;\n    vao.maxAttrib = Math.max(vao.maxAttrib, index);\n    const attrib = vao.attribs[index];\n    attrib.enabled = false;\n    return original.disableVertexAttribArray.apply(this, arguments);\n  };\n\n  gl.bindBuffer = function bindBuffer(target, buffer) {\n    switch (target) {\n      case gl.ARRAY_BUFFER:\n        self.currentArrayBuffer = buffer;\n        break;\n      case gl.ELEMENT_ARRAY_BUFFER:\n        self.currentVertexArrayObject.elementArrayBuffer = buffer;\n        break;\n      default:\n    }\n    return original.bindBuffer.apply(this, arguments);\n  };\n\n  gl.getVertexAttrib = function getVertexAttrib(index, pname) {\n    const vao = self.currentVertexArrayObject;\n    const attrib = vao.attribs[index];\n    switch (pname) {\n      case gl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:\n        return attrib.buffer;\n      case gl.VERTEX_ATTRIB_ARRAY_ENABLED:\n        return attrib.enabled;\n      case gl.VERTEX_ATTRIB_ARRAY_SIZE:\n        return attrib.size;\n      case gl.VERTEX_ATTRIB_ARRAY_STRIDE:\n        return attrib.stride;\n      case gl.VERTEX_ATTRIB_ARRAY_TYPE:\n        return attrib.type;\n      case gl.VERTEX_ATTRIB_ARRAY_NORMALIZED:\n        return attrib.normalized;\n      default:\n        return original.getVertexAttrib.apply(this, arguments);\n    }\n  };\n\n  gl.vertexAttribPointer = function vertexAttribPointer(\n    indx,\n    size,\n    type,\n    normalized,\n    stride,\n    offset\n  ) {\n    const vao = self.currentVertexArrayObject;\n    vao.maxAttrib = Math.max(vao.maxAttrib, indx);\n    const attrib = vao.attribs[indx];\n    attrib.buffer = self.currentArrayBuffer;\n    attrib.size = size;\n    attrib.type = type;\n    attrib.normalized = normalized;\n    attrib.stride = stride;\n    attrib.offset = offset;\n    attrib.recache();\n    return original.vertexAttribPointer.apply(this, arguments);\n  };\n\n  if (gl.instrumentExtension) {\n    gl.instrumentExtension(this, 'OES_vertex_array_object');\n  }\n\n  // undefined for headless gl\n  if (gl.canvas) {\n    gl.canvas.addEventListener(\n      'webglcontextrestored',\n      () => {\n        log('OESVertexArrayObject emulation library context restored');\n        self.reset_();\n      },\n      true\n    );\n  }\n\n  this.reset_();\n};\n\nOESVertexArrayObject.prototype.VERTEX_ARRAY_BINDING_OES = 0x85b5;\n\nOESVertexArrayObject.prototype.reset_ = function reset_() {\n  const contextWasLost = this.vertexArrayObjects !== undefined;\n  if (contextWasLost) {\n    for (let ii = 0; ii < this.vertexArrayObjects.length; ++ii) {\n      this.vertexArrayObjects.isAlive = false;\n    }\n  }\n  const gl = this.gl;\n  this.maxVertexAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n\n  this.defaultVertexArrayObject = new WebGLVertexArrayObjectOES(this);\n  this.currentVertexArrayObject = null;\n  this.currentArrayBuffer = null;\n  this.vertexArrayObjects = [this.defaultVertexArrayObject];\n\n  this.bindVertexArrayOES(null);\n};\n\nOESVertexArrayObject.prototype.createVertexArrayOES = function createVertexArrayOES() {\n  const arrayObject = new WebGLVertexArrayObjectOES(this);\n  this.vertexArrayObjects.push(arrayObject);\n  return arrayObject;\n};\n\nOESVertexArrayObject.prototype.deleteVertexArrayOES = function deleteVertexArrayOES(arrayObject) {\n  arrayObject.isAlive = false;\n  this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(arrayObject), 1);\n  if (this.currentVertexArrayObject === arrayObject) {\n    this.bindVertexArrayOES(null);\n  }\n};\n\nOESVertexArrayObject.prototype.isVertexArrayOES = function isVertexArrayOES(arrayObject) {\n  if (arrayObject && arrayObject instanceof WebGLVertexArrayObjectOES) {\n    if (arrayObject.hasBeenBound && arrayObject.ext === this) {\n      return true;\n    }\n  }\n  return false;\n};\n\nOESVertexArrayObject.prototype.bindVertexArrayOES = function bindVertexArrayOES(arrayObject) {\n  const gl = this.gl;\n  if (arrayObject && !arrayObject.isAlive) {\n    synthesizeGLError(\n      gl.INVALID_OPERATION,\n      'bindVertexArrayOES: attempt to bind deleted arrayObject'\n    );\n    return;\n  }\n  const original = this.original;\n\n  const oldVAO = this.currentVertexArrayObject;\n  this.currentVertexArrayObject = arrayObject || this.defaultVertexArrayObject;\n  this.currentVertexArrayObject.hasBeenBound = true;\n  const newVAO = this.currentVertexArrayObject;\n\n  if (oldVAO === newVAO) {\n    return;\n  }\n\n  if (!oldVAO || newVAO.elementArrayBuffer !== oldVAO.elementArrayBuffer) {\n    original.bindBuffer.call(gl, gl.ELEMENT_ARRAY_BUFFER, newVAO.elementArrayBuffer);\n  }\n\n  let currentBinding = this.currentArrayBuffer;\n  const maxAttrib = Math.max(oldVAO ? oldVAO.maxAttrib : 0, newVAO.maxAttrib);\n  for (let n = 0; n <= maxAttrib; n++) {\n    const attrib = newVAO.attribs[n];\n    const oldAttrib = oldVAO ? oldVAO.attribs[n] : null;\n\n    if (!oldVAO || attrib.enabled !== oldAttrib.enabled) {\n      if (attrib.enabled) {\n        original.enableVertexAttribArray.call(gl, n);\n      } else {\n        original.disableVertexAttribArray.call(gl, n);\n      }\n    }\n\n    if (attrib.enabled) {\n      let bufferChanged = false;\n      if (!oldVAO || attrib.buffer !== oldAttrib.buffer) {\n        if (currentBinding !== attrib.buffer) {\n          original.bindBuffer.call(gl, gl.ARRAY_BUFFER, attrib.buffer);\n          currentBinding = attrib.buffer;\n        }\n        bufferChanged = true;\n      }\n\n      if (bufferChanged || attrib.cached !== oldAttrib.cached) {\n        original.vertexAttribPointer.call(\n          gl,\n          n,\n          attrib.size,\n          attrib.type,\n          attrib.normalized,\n          attrib.stride,\n          attrib.offset\n        );\n      }\n    }\n  }\n\n  if (this.currentArrayBuffer !== currentBinding) {\n    original.bindBuffer.call(gl, gl.ARRAY_BUFFER, this.currentArrayBuffer);\n  }\n};\n\nexport function polyfillVertexArrayObject(gl) {\n  if (typeof gl.createVertexArray === 'function') {\n    // VAOs directly supported on object (i.e. WebGL 2 context)\n    return;\n  }\n\n  const original_getSupportedExtensions = gl.getSupportedExtensions;\n  gl.getSupportedExtensions = function getSupportedExtensions() {\n    const list = original_getSupportedExtensions.call(this) || [];\n    if (list.indexOf('OES_vertex_array_object') < 0) {\n      list.push('OES_vertex_array_object');\n    }\n    return list;\n  };\n\n  const original_getExtension = gl.getExtension;\n  gl.getExtension = function getExtension(name) {\n    const ext = original_getExtension.call(this, name);\n    if (ext) {\n      return ext;\n    }\n    if (name !== 'OES_vertex_array_object') {\n      return null;\n    }\n\n    if (!gl.__OESVertexArrayObject) {\n      this.__OESVertexArrayObject = new OESVertexArrayObject(this);\n    }\n    return this.__OESVertexArrayObject;\n  };\n}\n"],"file":"polyfill-vertex-array-object.js"}