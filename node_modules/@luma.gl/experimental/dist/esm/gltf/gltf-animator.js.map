{"version":3,"sources":["../../../src/gltf/gltf-animator.js"],"names":["assert","log","Matrix4","Quaternion","ATTRIBUTE_TYPE_TO_COMPONENTS","SCALAR","VEC2","VEC3","VEC4","MAT2","MAT3","MAT4","ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY","Int8Array","Uint8Array","Int16Array","Uint16Array","Uint32Array","Float32Array","accessorToJsArray","accessor","_animation","ArrayType","componentType","components","type","length","count","bufferView","data","buffer","byteOffset","array","Array","from","slicedArray","i","push","slice","helperMatrix","applyTranslationRotationScale","gltfNode","node","matrix","identity","translation","translate","rotation","rotationMatrix","fromQuaternion","multiplyRight","scale","quaternion","linearInterpolate","target","path","start","stop","ratio","slerp","cubicsplineInterpolate","p0","outTangent0","inTangent1","p1","tDiff","t","m0","m1","Math","pow","stepInterpolate","value","interpolate","time","input","interpolation","output","maxTime","animationTime","nextIndex","findIndex","previousIndex","max","isArray","warn","previousTime","nextTime","GLTFAnimation","props","startTime","playing","speed","Object","assign","timeMs","absTime","channels","forEach","sampler","_node","GLTFAnimator","gltf","animations","map","animation","index","name","samplers","accessors","nodes","setTime","animate"],"mappings":"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","sourcesContent":["import {assert, log} from '@luma.gl/webgl';\nimport {Matrix4, Quaternion} from 'math.gl';\n\n// TODO: import from loaders.gl?\nexport const ATTRIBUTE_TYPE_TO_COMPONENTS = {\n  SCALAR: 1,\n  VEC2: 2,\n  VEC3: 3,\n  VEC4: 4,\n  MAT2: 4,\n  MAT3: 9,\n  MAT4: 16\n};\n\nexport const ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY = {\n  5120: Int8Array,\n  5121: Uint8Array,\n  5122: Int16Array,\n  5123: Uint16Array,\n  5125: Uint32Array,\n  5126: Float32Array\n};\n//\n\nfunction accessorToJsArray(accessor) {\n  if (!accessor._animation) {\n    const ArrayType = ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY[accessor.componentType];\n    const components = ATTRIBUTE_TYPE_TO_COMPONENTS[accessor.type];\n    const length = components * accessor.count;\n    const {buffer, byteOffset} = accessor.bufferView.data;\n\n    const array = new ArrayType(buffer, byteOffset + (accessor.byteOffset || 0), length);\n\n    if (components === 1) {\n      accessor._animation = Array.from(array);\n    } else {\n      // Slice array\n      const slicedArray = [];\n      for (let i = 0; i < array.length; i += components) {\n        slicedArray.push(Array.from(array.slice(i, i + components)));\n      }\n      accessor._animation = slicedArray;\n    }\n  }\n\n  return accessor._animation;\n}\n\n// TODO: share with GLTFInstantiator\nconst helperMatrix = new Matrix4();\nfunction applyTranslationRotationScale(gltfNode, node) {\n  node.matrix.identity();\n\n  if (gltfNode.translation) {\n    node.matrix.translate(gltfNode.translation);\n  }\n\n  if (gltfNode.rotation) {\n    const rotationMatrix = helperMatrix.fromQuaternion(gltfNode.rotation);\n    node.matrix.multiplyRight(rotationMatrix);\n  }\n\n  if (gltfNode.scale) {\n    node.matrix.scale(gltfNode.scale);\n  }\n}\n\nconst quaternion = new Quaternion();\nfunction linearInterpolate(target, path, start, stop, ratio) {\n  if (path === 'rotation') {\n    // SLERP when path is rotation\n    quaternion.slerp({start, target: stop, ratio});\n    for (let i = 0; i < quaternion.length; i++) {\n      target[path][i] = quaternion[i];\n    }\n  } else {\n    // regular interpolation\n    for (let i = 0; i < start.length; i++) {\n      target[path][i] = ratio * stop[i] + (1 - ratio) * start[i];\n    }\n  }\n}\n\nfunction cubicsplineInterpolate(target, path, {p0, outTangent0, inTangent1, p1, tDiff, ratio: t}) {\n  // TODO: Quaternion might need normalization\n  for (let i = 0; i < target[path].length; i++) {\n    const m0 = outTangent0[i] * tDiff;\n    const m1 = inTangent1[i] * tDiff;\n    target[path][i] =\n      (2 * Math.pow(t, 3) - 3 * Math.pow(t, 2) + 1) * p0[i] +\n      (Math.pow(t, 3) - 2 * Math.pow(t, 2) + t) * m0 +\n      (-2 * Math.pow(t, 3) + 3 * Math.pow(t, 2)) * p1[i] +\n      (Math.pow(t, 3) - Math.pow(t, 2)) * m1;\n  }\n}\n\nfunction stepInterpolate(target, path, value) {\n  for (let i = 0; i < value.length; i++) {\n    target[path][i] = value[i];\n  }\n}\n\nfunction interpolate(time, {input, interpolation, output}, target, path) {\n  const maxTime = input[input.length - 1];\n  const animationTime = time % maxTime;\n\n  const nextIndex = input.findIndex(t => t >= animationTime);\n  const previousIndex = Math.max(0, nextIndex - 1);\n\n  if (!Array.isArray(target[path])) {\n    switch (path) {\n      case 'translation':\n        target[path] = [0, 0, 0];\n        break;\n\n      case 'rotation':\n        target[path] = [0, 0, 0, 1];\n        break;\n\n      case 'scale':\n        target[path] = [1, 1, 1];\n        break;\n\n      default:\n        log.warn(`Bad animation path ${path}`)();\n    }\n  }\n\n  assert(target[path].length === output[previousIndex].length);\n  const previousTime = input[previousIndex];\n  const nextTime = input[nextIndex];\n\n  switch (interpolation) {\n    case 'STEP':\n      stepInterpolate(target, path, output[previousIndex]);\n      break;\n\n    case 'LINEAR':\n      if (nextTime > previousTime) {\n        const ratio = (animationTime - previousTime) / (nextTime - previousTime);\n        linearInterpolate(target, path, output[previousIndex], output[nextIndex], ratio);\n      }\n      break;\n\n    case 'CUBICSPLINE':\n      if (nextTime > previousTime) {\n        const ratio = (animationTime - previousTime) / (nextTime - previousTime);\n        const tDiff = nextTime - previousTime;\n\n        const p0 = output[3 * previousIndex + 1];\n        const outTangent0 = output[3 * previousIndex + 2];\n        const inTangent1 = output[3 * nextIndex + 0];\n        const p1 = output[3 * nextIndex + 1];\n\n        cubicsplineInterpolate(target, path, {p0, outTangent0, inTangent1, p1, tDiff, ratio});\n      }\n      break;\n\n    default:\n      log.warn(`Interpolation ${interpolation} not supported`)();\n      break;\n  }\n}\n\nclass GLTFAnimation {\n  constructor(props) {\n    this.startTime = 0;\n    this.playing = true;\n    this.speed = 1;\n\n    Object.assign(this, props);\n  }\n\n  animate(timeMs) {\n    if (!this.playing) {\n      return;\n    }\n\n    const absTime = timeMs / 1000;\n    const time = (absTime - this.startTime) * this.speed;\n\n    this.channels.forEach(({sampler, target, path}) => {\n      interpolate(time, sampler, target, path);\n      applyTranslationRotationScale(target, target._node);\n    });\n  }\n}\n\nexport default class GLTFAnimator {\n  constructor(gltf) {\n    this.animations = gltf.animations.map((animation, index) => {\n      const name = animation.name || `Animation-${index}`;\n      const samplers = animation.samplers.map(({input, interpolation = 'LINEAR', output}) => ({\n        input: accessorToJsArray(gltf.accessors[input]),\n        interpolation,\n        output: accessorToJsArray(gltf.accessors[output])\n      }));\n      const channels = animation.channels.map(({sampler, target}) => ({\n        sampler: samplers[sampler],\n        target: gltf.nodes[target.node],\n        path: target.path\n      }));\n      return new GLTFAnimation({name, channels});\n    });\n  }\n\n  // TODO(Tarek): This should be removed? (deck.gl is using this)\n  animate(time) {\n    this.setTime(time);\n  }\n\n  setTime(time) {\n    this.animations.forEach(animation => animation.animate(time));\n  }\n\n  getAnimations() {\n    return this.animations;\n  }\n}\n"],"file":"gltf-animator.js"}